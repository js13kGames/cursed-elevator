pxtex=(t,s,i,e,h=10,o=10,W=10,n=t.getContext`2d`,r,l,a=Math.random)=>{for(t.width=o,t.height=W,r=o;r--;)for(l=W;l--;)n.fillStyle=`hsl(${s+(a()-.5)*h},${i+(a()-.5)*h}%,${e+(a()-.5)*h}%)`,n.fillRect(r,l,1,1)},debug=1,W={i:{},reset:s=>{W.canvas=s,W.objs=0,W.current={},W.next={},W.o={},W.W=!1,W.gl=s.getContext("webgl2"),W.gl.blendFunc(770,771),W.gl.activeTexture(33984),W.program=W.gl.createProgram(),W.gl.enable(2884),W.gl.shaderSource(t=W.gl.createShader(35633),"#version 300 es\nprecision highp float;in vec4 pos, col, uv;uniform mat4 pv, eye, m, im;uniform vec4 bb;out vec4 v_pos, v_col, v_uv;void main() {gl_Position = pv * (v_pos = bb.z > 0.? m[3] + eye * (pos * bb): m * pos);v_col = col;v_uv = uv;}"),W.gl.compileShader(t),W.gl.attachShader(W.program,t),console.log("vertex shader:",W.gl.getShaderInfoLog(t)||"OK"),W.gl.shaderSource(t=W.gl.createShader(35632),"#version 300 es\nprecision highp float;in vec4 v_pos, v_col, v_uv;uniform vec3 light;uniform vec4 o;uniform sampler2D sampler;out vec4 c;void main() {float ambient = o[2];vec3 light_dir = normalize(light - v_pos.xyz);vec3 normal = normalize(cross(dFdx(v_pos.xyz), dFdy(v_pos.xyz)));float lambert = max(0., dot(light_dir, normal)) * 0.7;float specular = 0.;if(o[0] > 0.) {vec3 R = reflect(-light_dir, normal);vec3 V = normalize(-v_pos.xyz);float specAngle = max(dot(R, V), 0.);specular = pow(specAngle, o[0]) * 0.3;}c = mix(texture(sampler, v_uv.xy), v_col, o[3]);c = vec4(c.rgb * (ambient + lambert + specular), c.a);}"),W.gl.compileShader(t),W.gl.attachShader(W.program,t),console.log("fragment shader:",W.gl.getShaderInfoLog(t)||"OK"),W.gl.linkProgram(W.program),W.gl.useProgram(W.program),console.log("program:",W.gl.getProgramInfoLog(W.program)||"OK"),W.gl.clearColor(1,1,1,1),W.clearColor=t=>W.gl.clearColor(...W.l(t)),W.clearColor("fff"),W.gl.enable(2929),W.u({y:1}),W.camera({fov:30}),setTimeout(W.draw,16)},m:(t,s,i,e,h=[],o,n,r,l,a,c,d,u)=>{if(t.n||="o"+W.objs++,t.size&&(t.w=t.h=t.d=t.size),t.t&&t.t.width&&!W.o[t.t.id]&&(i=W.gl.createTexture(),W.gl.pixelStorei(37441,!0),W.gl.bindTexture(3553,i),W.gl.pixelStorei(37440,1),W.gl.texImage2D(3553,0,6408,6408,5121,t.t),W.gl.generateMipmap(3553),W.o[t.t.id]=i),t.fov){const s=1/Math.tan(t.fov*Math.PI/180),i=.1,e=1e3,h=e-i;W.projection=new DOMMatrix([s/(W.canvas.width/W.canvas.height),0,0,0,0,s,0,0,0,0,-(e+i)/h,-1,0,0,-2*e*i/h,0])}t={type:s,...W.current[t.n]=W.next[t.n]||{w:1,h:1,d:1,x:0,y:0,z:0,rx:0,ry:0,rz:0,b:"888",mode:4,mix:0},...t,f:0},W.i[t.type]?.vertices&&!W.i?.[t.type].verticesBuffer&&(W.gl.bindBuffer(34962,W.i[t.type].verticesBuffer=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array(W.i[t.type].vertices),35044),W.i[t.type].v||W.smooth(t),W.i[t.type].v&&(W.gl.bindBuffer(34962,W.i[t.type].normalsBuffer=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array(W.i[t.type].v.flat()),35044))),W.i[t.type]?.uv&&!W.i[t.type].uvBuffer&&(W.gl.bindBuffer(34962,W.i[t.type].uvBuffer=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array(W.i[t.type].uv),35044)),W.i[t.type]?.indices&&!W.i[t.type].indicesBuffer&&(W.gl.bindBuffer(34963,W.i[t.type].indicesBuffer=W.gl.createBuffer()),W.gl.bufferData(34963,new Uint16Array(W.i[t.type].indices),35044)),t.t?t.t&&!t.mix&&(t.mix=0):t.mix=1,W.next[t.n]=t},draw:(t,s,i,e,h=[])=>{if(s=t-W.lastFrame,W.lastFrame=t,requestAnimationFrame(W.draw),W.W)W.onDraw(t);else{for(e in W.next.camera.g&&W.p(W.next[W.next.camera.g],s,1),i=W.animation("camera"),W.next?.camera?.g&&i.preMultiplySelf(W.next[W.next.camera.g]._),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.program,"eye"),!1,i.toFloat32Array()),i.invertSelf(),i.preMultiplySelf(W.projection),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.program,"pv"),!1,i.toFloat32Array()),W.gl.clear(16640),W.next){const t=W.next[e];t.t||1!=W.l(t.b)[3]?h.push(t):W.p(t,s)}for(e of(h.sort(((t,s)=>W.M(s)-W.M(t))),W.gl.enable(3042),h))["plane","billboard"].includes(e.type)&&W.gl.depthMask(0),W.p(e,s),W.gl.depthMask(1);W.gl.disable(3042),W.gl.uniform3f(W.gl.getUniformLocation(W.program,"light"),W.A("light","x"),W.A("light","y"),W.A("light","z")),W.onDraw(t)}},p:(t,s,i=["camera","light","group"].includes(t.type),e)=>{t.t&&(W.gl.bindTexture(3553,W.o[t.t.id]),W.gl.uniform1i(W.gl.getUniformLocation(W.program,"sampler"),0)),t.f>=t.a?(t.onAnimDone?.(),delete t.a,delete t.onAnimDone):t.f<t.a&&(t.f+=s),t.f>t.a&&(t.f=t.a),W.next[t.n]._=W.animation(t.n),W.next[t.g]&&W.next[t.n]._.preMultiplySelf(W.next[t.g]._),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.program,"m"),!1,W.next[t.n]._.toFloat32Array()),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.program,"im"),!1,DOMMatrix.fromMatrix(W.next[t.n]._).invertSelf().toFloat32Array()),i||(W.gl.bindBuffer(34962,W.i[t.type].verticesBuffer),W.gl.vertexAttribPointer(e=W.gl.getAttribLocation(W.program,"pos"),3,5126,!1,0,0),W.gl.enableVertexAttribArray(e),W.i[t.type].uvBuffer&&(W.gl.bindBuffer(34962,W.i[t.type].uvBuffer),W.gl.vertexAttribPointer(e=W.gl.getAttribLocation(W.program,"uv"),2,5126,!1,0,0),W.gl.enableVertexAttribArray(e)),W.gl.uniform4f(W.gl.getUniformLocation(W.program,"o"),t.s,(t.mode>3||W.gl[t.mode]>3)&&!t.O?1:0,W.ambientLight||.2,t.mix),W.gl.uniform4f(W.gl.getUniformLocation(W.program,"bb"),t.w,t.h,"billboard"==t.type,0),W.i[t.type].indicesBuffer&&W.gl.bindBuffer(34963,W.i[t.type].indicesBuffer),W.gl.vertexAttrib4fv(W.gl.getAttribLocation(W.program,"col"),W.l(t.b)),W.i[t.type].indicesBuffer?W.gl.drawElements(+t.mode||W.gl[t.mode],W.i[t.type].indices.length,5123,0):W.gl.drawArrays(+t.mode||W.gl[t.mode],0,W.i[t.type].vertices.length/3))},A:(t,s)=>{const i=W.next[t];if(!i?.a)return i[s];const e=W.current[t];return e[s]+(i[s]-e[s])*(i.f/i.a)},animation:(t,s=new DOMMatrix)=>W.next[t]?s.translateSelf(W.A(t,"x"),W.A(t,"y"),W.A(t,"z")).rotateSelf(W.A(t,"rx"),W.A(t,"ry"),W.A(t,"rz")).scaleSelf(W.A(t,"w"),W.A(t,"h"),W.A(t,"d")):s,M:(t,s=W.next.camera)=>t?._&&s?._?(s._.m41-t._.m41)**2+(s._.m42-t._.m42)**2+(s._.m43-t._.m43)**2:0,T:t=>W.ambientLight=t,l:t=>[...t.match(t.length<5?/./g:/../g).map((s=>("0x"+s)/(t.length<5?15:255))),1],add:(t,s)=>{W.i[t]=s,s.v&&(W.i[t].customNormals=1),W[t]=s=>W.m(s,t)},group:t=>W.m(t,"group"),move:(t,s)=>setTimeout((()=>{W.m(t)}),s||1),delete:(t,s)=>setTimeout((()=>{delete W.next[t]}),s||1),camera:(t,s)=>setTimeout((()=>{W.m(t,t.n="camera")}),s||1),u:(t,s)=>s?setTimeout((()=>{W.m(t,t.n="light")}),s):W.m(t,t.n="light")},W.smooth=(t,s={},i=[],e,h,o,n,r,l,a,c,d,u,m)=>{for(W.i[t.type].v=[],o=0;o<W.i[t.type].vertices.length;o+=3)i.push(W.i[t.type].vertices.slice(o,o+3));for((e=W.i[t.type].indices)?h=1:(e=i,h=0),o=0;o<2*e.length;o+=3){n=o%e.length,r=i[c=h?W.i[t.type].indices[n]:n],l=i[d=h?W.i[t.type].indices[n+1]:n+1],a=i[u=h?W.i[t.type].indices[n+2]:n+2],AB=[l[0]-r[0],l[1]-r[1],l[2]-r[2]],BC=[a[0]-l[0],a[1]-l[1],a[2]-l[2]],m=o>n?[0,0,0]:[AB[1]*BC[2]-AB[2]*BC[1],AB[2]*BC[0]-AB[0]*BC[2],AB[0]*BC[1]-AB[1]*BC[0]];const f=r[0]+"_"+r[1]+"_"+r[2],v=l[0]+"_"+l[1]+"_"+l[2],x=a[0]+"_"+a[1]+"_"+a[2];s[f]||=[0,0,0],s[v]||=[0,0,0],s[x]||=[0,0,0],W.i[t.type].v[c]=s[f]=s[f].map(((t,s)=>t+m[s])),W.i[t.type].v[d]=s[v]=s[v].map(((t,s)=>t+m[s])),W.i[t.type].v[u]=s[x]=s[x].map(((t,s)=>t+m[s]))}},W.add("plane",{vertices:[.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[1,1,0,1,0,0,1,1,0,0,1,0]}),W.add("billboard",W.i.plane),W.add("cube",{vertices:[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5],uv:[1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0]}),W.cube=t=>W.m(t,"cube"),W.add("pyramid",{vertices:[-.5,-.5,.5,.5,-.5,.5,0,.5,0,.5,-.5,.5,.5,-.5,-.5,0,.5,0,.5,-.5,-.5,-.5,-.5,-.5,0,.5,0,-.5,-.5,-.5,-.5,-.5,.5,0,.5,0,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5],uv:[0,0,1,0,.5,1,0,0,1,0,.5,1,0,0,1,0,.5,1,0,0,1,0,.5,1,1,1,0,1,0,0,1,1,0,0,1,0]}),((t,s,i,e,h,o,n=[],r=[],l=[],a=20)=>{for(i=0;i<=a;i++)for(e=i*Math.PI/a,t=0;t<=a;t++)s=2*t*Math.PI/a,n.push(+(Math.sin(s)*Math.sin(e)/2).toFixed(6),+(Math.cos(e)/2).toFixed(6),+(Math.cos(s)*Math.sin(e)/2).toFixed(6)),l.push(3.5*Math.sin(t/a),-Math.sin(i/a)),t<a&&i<a&&r.push(h=i*(a+1)+t,o=h+a+1,h+1,h+1,o,o+1);W.add("sphere",{vertices:n,uv:l,indices:r})})();let s=new AudioContext;"use strict";const i={N:'"Courier New", monospace',D:"Arial, sans-serif",I:'"Times New Roman", serif',S:30,C:60,K:"Triskaidekaphobia",init(){i.B.R((()=>{i.F.init(),i.k.init()}))},P(){const t=localStorage.getItem("2024_sd_elevator.save");return t?JSON.parse(t):null},L(t){localStorage.setItem("2024_sd_elevator.save",JSON.stringify({level:t}))}};window.addEventListener("load",(()=>i.init())),i.B={U:{s_note1:"I'm leaving this note for whoever gets lost\nhere as well. You are now stuck in a cursed\nelevator. But if I'm not in here (and neither\nmy dead body), I must've made it out!\n\nDon't worry, I'm going to leave you some\ntips as I figure this situation out!"},o:{},G(){for(let t=1;t<=14;t++){const s="s_lbl_btn"+t,[e,h]=i.k.V(100,70,s);h.font="600 32px "+i.D,h.textAlign="center",h.textBaseline="middle",h.fillText(String(t).padStart(2,"0"),50,37),this.o[s]=e}},$(){const t=Math.round(70.7),s=i.k.V(50,t,"paper")[0];pxtex(s,0,0,95,3,50,t),this.o.j=s},H(){const t=i.k.V(200,300,"wall")[0];pxtex(t,0,0,20,3,200,300),this.o.J=t;const s=i.k.V(100,100,"ceil")[0];pxtex(s,0,0,100,3,100,100),this.o.ceil=s;const e=i.k.V(100,100,"floor")[0];pxtex(e,0,0,10,1,100,100),this.o.floor=e;const h=i.k.V(40,300,"fs")[0];pxtex(h,0,0,20,3,40,300),this.o.Y=h;const o=i.k.V(200,75,"ft")[0];pxtex(o,0,0,20,3,200,75),this.o.q=o},Z(){const t=Math.round(120),[s,e]=i.k.V(600,t,"title");e.fillStyle="#f00",e.font="600 64px "+i.D,e.textAlign="center",e.fillText(i.K,300,t/2),this.o.title=s},X(t){const s=200,e=Math.round(100),[h,o]=i.k.V(s,e,"dis:"+t);return o.fillStyle="#f00",o.fillRect(0,0,s,e),o.fillStyle="#fff",o.font="600 64px "+i.N,o.textAlign="center",o.textBaseline="middle",o.fillText(String(t),100,e/2+6),h},R(t){this.Z(),this.G(),this.H(),this.$(),t()}},i.Audio={tt:[.5,0,626,,.01,.01,,2.2,,,,,,,,.1,.01,.79,.02],st:[2,0,783.99,.07,,1.6,1,2,,,,,,,,,,.3,.15],ERROR:[.7,0,71,,.02,.05,3,.2,,68,,,,,,,.01,.96,.02,,389],it:[1.2,0,242,.01,.08,,1,1.8,,-5,,,,.1,18,.1,.02,.88,.03,,-1452],et:[.5,0,817,.03,,.008,3,2.8,,,,,,,,,,.9,.01,.19,-1491],play(t){((t=1,i=.05,e=220,h=0,o=0,W=.1,n=0,r=1,l=0,a=0,c=0,d=0,u=0,m=0,f=0,v=0,x=0,p=1,y=0,b=0,g=0)=>{let w=Math,_=2*w.PI,M=44100,z=l*=500*_/M/M,A=e*=(1-i+2*i*w.random(i=[]))*_/M,O=0,E=0,T=0,N=1,D=0,I=0,S=0,C=g<0?-1:1,K=_*C*g*2/M,R=w.cos(K),B=w.sin,F=B(K)/4,k=1+F,P=-2*R/k,L=(1-F)/k,U=(1+C*R)/2/k,G=-(C+R)/k,V=U,$=0,j=0,H=0,J=0;for(a*=500*_/M**3,f*=_/M,c*=_/M,d*=M,u=M*u|0,t*=.3,C=(h=M*h+9)+(y*=M)+(o*=M)+(W*=M)+(x*=M)|0;T<C;i[T++]=S*t)++I%(100*v|0)||(S=n?1<n?2<n?3<n?B(O**3):w.max(w.min(w.tan(O),1),-1):1-(2*O/_%2+2)%2:1-4*w.abs(w.round(O/_)-O/_):B(O),S=(u?1-b+b*B(_*T/u):1)*(S<0?-1:1)*w.abs(S)**r*(T<h?T/h:T<h+y?1-(T-h)/y*(1-p):T<h+y+o?p:T<C-x?(C-T-x)/W*p:0),S=x?S/2+(x>T?0:(T<C-x?1:(C-T)/x)*i[T-x|0]/2/t):S,g&&(S=J=V*$+G*($=j)+U*(j=S)-L*H-P*(H=J))),K=(e+=l+=a)*w.cos(f*E++),O+=K+K*m*B(T**5),N&&++N>d&&(e+=c,A+=c,N=0),!u||++D%u||(e=A,l=z,N=N||1);(t=s.createBuffer(1,C,M)).getChannelData(0).set(i),(e=s.createBufferSource()).buffer=t,e.connect(s.destination),e.start()})(...t)}},i.F={ht:{ot:1,Wt:2,nt:3,rt:10,lt:11,ct:12,dt:13},ut:{},ft:{},vt:{},xt:{},yt(){this.bt={[this.ht.ot]:{keyboard:["Escape"]},[this.ht.lt]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"]},[this.ht.rt]:{keyboard:["ArrowLeft","KeyA","KeyQ"]},[this.ht.dt]:{keyboard:["ArrowDown","KeyS"]},[this.ht.ct]:{keyboard:["ArrowRight","KeyD"]},[this.ht.Wt]:{keyboard:["KeyE","Enter"]}}},gt(){let t=0,s=0;return this.wt(this.ht.rt)?t=-1:this.wt(this.ht.ct)&&(t=1),this.wt(this.ht.lt)?s=-1:this.wt(this.ht.dt)&&(s=1),{x:t,y:s}},_t(t){return this.bt[t]},init(){this.yt(),this.Mt()},wt(t,s){const i=this._t(t);for(const t of i.keyboard)if(this.zt(t,s))return!0;return!1},zt(t,s){const i=this.xt[t];return!(!i||!i.time)&&(s&&(i.time=0,i.At=!0),!0)},Ot(t,s){const i=this.ft[t]||[];i.push(s),this.ft[t]=i},Et(t,s){const i=this.vt[t]||[];i.push(s),this.vt[t]=i},Mt(){document.body.onkeydown=t=>{const s=this.xt[t.code];s&&s.At||(this.xt[t.code]={time:Date.now()},this.ft[t.code]&&this.ft[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.xt[t.code]={time:0},this.vt[t.code]&&this.vt[t.code].forEach((t=>t()))}}},i.k={camera:{rx:0,ry:0},Tt:!0,Nt:null,Dt:null,It:null,St:null,Ct:new DOMPoint(0,0,-1),Kt:0,Rt(){let t=[];const s=this.Bt(),i={min:[],max:[]};for(const e in W.next){if(!e.startsWith("s_"))continue;const h=W.next[e];let o=0;if("plane"!=h.type&&"billboard"!=h.type&&(o=h.d),i.min[0]=h.x-h.w/2,i.min[1]=h.y-h.h/2,i.min[2]=h.z-o/2,h.g){const t=W.next[h.g];i.min[0]+=t.x,i.min[1]+=t.y,i.min[2]+=t.z}i.max[0]=i.min[0]+h.w,i.max[1]=i.min[1]+h.h,i.max[2]=i.min[2]+o;const n=this.Ft(s,i);n&&t.push([h,n])}return this.kt(s.origin,t)},Pt(t){const s=Math.round(Math.min(735.28,window.innerHeight-40)),e=(this.Dt.width-520)/2,h=(this.Dt.height-s)/2;this.St.drawImage(i.B.o.j,e,h,520,s),this.St.fillStyle="#000",this.St.font="24px "+i.D,this.St.textAlign="left",this.St.textBaseline="top";const o=t.split("\n");for(let t=0;t<o.length;t++)this.St.fillText(o[t],e+20,h+20+29*t)},Lt(){this.St.fillStyle="#00000070",this.St.fillRect(0,0,this.Dt.width,this.Dt.height),this.St.fillStyle="#fff",this.St.font="96px "+i.I,this.St.textAlign="center",this.St.fillText("PAUSED",this.Dt.width/2,this.Dt.height/2)},kt(t,s){if(1==s.length)return s[0][0];let i=null,e=1/0;for(let h=0;h<s.length;h++){const o=s[h][1],W=[o[0]-t[0],o[1]-t[1],o[2]-t[2]],n=Math.sqrt(W[0]*W[0]+W[1]*W[1]+W[2]*W[2]);n<e&&(i=s[h][0],e=n)}return i},V(t,s,i){const e=document.createElement("canvas");e.width=t,e.height=s,i&&(e.id=i);const h=e.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[e,h]},Bt(){const t=W.next.camera,s=(new DOMMatrix).rotateSelf(t.rx,t.ry,t.rz),i={origin:[t.x,t.y,t.z],dir:this.Ct.matrixTransform(s)};return i.dir=[i.dir.x,i.dir.y,i.dir.z],i},init(){this.Nt=document.getElementById("c"),this.Dt=document.getElementById("ui"),this.St=this.Dt.getContext("2d",{alpha:!0}),this.St.imageSmoothingEnabled=!1,this.resize(),W.onDraw=this.update.bind(this),W.reset(this.Nt),W.clearColor("000"),W.T(.2),this.Mt(),this.level=new i.Ut},Ft(t,s){let i=!0,e=[],h=[],o=[],W=[];for(let h=0;h<3;h++)t.origin[h]<s.min[h]?(e[h]=1,o[h]=s.min[h],i=!1):t.origin[h]>s.max[h]?(e[h]=0,o[h]=s.max[h],i=!1):e[h]=2;if(i)return t.origin;for(let s=0;s<3;s++)2!=e[s]&&0!=t.dir[s]?h[s]=(o[s]-t.origin[s])/t.dir[s]:h[s]=-1;let n=0;for(let t=1;t<3;t++)h[n]<h[t]&&(n=t);if(h[n]<0)return null;for(let i=0;i<3;i++)if(n!=i){if(W[i]=t.origin[i]+h[n]*t.dir[i],W[i]<s.min[i]||W[i]>s.max[i])return null}else W[i]=o[i];return W},pause(){this.W=!0,document.body.classList.add("p"),W.W=!0},Mt(){let t=null,s=null;window.addEventListener("resize",(t=>this.resize()));const e=i.F._t(i.F.ht.ot),h=()=>{this.Gt(),t=null,s=null};e.keyboard.forEach((t=>i.F.Et(t,h))),this.Nt.addEventListener("mousedown",(t=>{0===t.button&&this.level&&this.level.Vt()})),this.Nt.addEventListener("mouseenter",(i=>{this.level&&!this.Tt&&(t=i.clientX,s=i.clientY)})),this.Nt.addEventListener("mousemove",(i=>{if(this.level&&!this.W&&!this.Tt){if(null===t)return t=i.clientX,void(s=i.clientY);this.camera.rx-=.5*(i.clientY-s),this.camera.ry-=.5*(i.clientX-t),this.camera.rx=Math.min(80,Math.max(-60,this.camera.rx)),this.camera.ry=this.camera.ry%360,W.camera(this.camera),t=i.clientX,s=i.clientY}})),i.F.Et("KeyR",(()=>{this.Tt||(this.camera.rx=0,this.camera.ry=0,W.camera(this.camera))}))},resize(){const t=4/3;let s=window.innerWidth,i=window.innerHeight;s>i?(i-=40,s=Math.round(Math.min(s,i*t))):s<i&&(s-=40,i=Math.round(Math.min(i,s*t))),this.Nt.width=s,this.Nt.height=i,this.Dt.width=s,this.Dt.height=i,W.next?.camera&&(W.camera({fov:W.next.camera.fov}),W.gl.viewport(0,0,s,i))},Gt(){this.W?this.unpause():this.pause()},unpause(){this.W=!1,document.body.classList.remove("p"),W.W=!1},update(t=0){if(t&&this.$t){const s=(t-this.$t)/(1e3/i.C);if(this.St.clearRect(0,0,this.Dt.width,this.Dt.height),this.St.imageSmoothingEnabled=!1,this.St.fillStyle="#fff",this.St.font="11px monospace",this.St.textAlign="left",this.St.fillText(~~(i.C/s)+" FPS",10,20),this.W)return void this.Lt();this.Kt+=s,this.level.update(s)}this.$t=t}},i.jt={K:1,Ht:2,Jt:3,Qt:4},i.Yt={OPEN:1,OPENING:2,CLOSED:3,CLOSING:4,IDLE:5,qt:6},i.Ut=class{constructor(){this.Kt=0,this.Zt=0,this.Xt=i.jt.K,this.states={ts:i.Yt.OPEN,ss:i.Yt.IDLE,es:1,hs:1,note:null},this.os=2,this.Ws=3,this.ns=2,W.u({y:this.Ws/2-.2}),W.plane({n:"title",x:0,y:0,z:-2,w:1,h:.2,b:"f00",t:i.B.o.title}),W.group({n:"ev"}),this.rs(),this.ls(),this.cs(),this.ds()}cs(){const t="display";W.group({n:t,g:"ev",y:this.Ws/2-.25-.15,z:-this.ns/2+.06}),W.plane({g:t,n:"dis",w:.5,h:.25,b:"f00"})}ls(){const t=this.os/2,s=.05;this.us=t/2+.0025,this.fs=this.us+this.os/2-this.os/4,W.cube({n:"dl",g:"ev",x:-this.fs,y:0,z:-this.ns/2,w:t,h:this.Ws,d:s,b:"aaa",s:20}),W.group({n:"drg",g:"ev",x:this.fs,y:0,z:-this.ns/2}),W.cube({n:"dr",g:"drg",w:t,h:this.Ws,d:s,b:"aaa",s:20});const e=t/4;W.plane({n:"s_note1",g:"drg",x:(e-t)/2+.1,y:-.1,z:.025+.001,w:e,h:1.414*e,rz:-10,t:i.B.o.j})}ds(){const t="pad";W.group({n:t,g:"ev",x:this.os/2-.15-.06,y:.075-.35,z:-this.ns/2+.06}),W.plane({g:t,w:.3,h:.7,b:"bbb",s:20});const s=.02,e=.1,h=.07,o=(e+s)/2;for(let n=0;n<14;n++){const r="btn"+(n+1),l=n%2*(s+e)-o,a=~~(n/2)*(s+h)-.27;W.cube({g:t,n:r,x:l,y:a,w:e,h,d:.02,b:"ddd"}),W.plane({g:t,n:"s_lbl_"+r,x:l,y:a,z:.011,w:e,h,t:i.B.o["s_lbl_"+r]})}}rs(){const t="ev";W.group({n:t,g:"ev"}),W.plane({g:t,x:0,y:-this.Ws/2,z:0,w:this.os,h:this.ns,rx:-90,b:"333",t:i.B.o.floor,mix:.5}),W.plane({g:t,x:0,y:this.Ws/2,z:0,w:this.os,h:this.ns,rx:90,b:"bbb",t:i.B.o.ceil,mix:.5}),W.plane({g:t,x:-this.os/2,y:0,z:0,ry:90,w:this.ns,h:this.Ws,b:"999",t:i.B.o.J,s:30,mix:.5}),W.plane({g:t,x:this.os/2,y:0,z:0,ry:-90,w:this.ns,h:this.Ws,b:"999",t:i.B.o.J,s:30,mix:.5}),W.plane({g:t,x:0,y:0,z:this.ns/2,ry:180,w:this.os,h:this.Ws,b:"999",t:i.B.o.J,s:30,mix:.5}),W.cube({g:t,x:-(this.os-this.os/5)/2,y:0,z:-this.ns/2,w:this.os/5,h:this.Ws,d:.1,b:"999",t:i.B.o.Y,s:30,mix:.5}),W.cube({g:t,x:(this.os-this.os/5)/2,y:0,z:-this.ns/2,w:this.os/5,h:this.Ws,d:.1,b:"999",t:i.B.o.Y,s:30,mix:.5}),W.cube({g:t,x:0,y:(this.Ws-this.Ws/4)/2,z:-this.ns/2,w:this.os,h:this.Ws/4,d:.1,b:"999",t:i.B.o.q,s:30,mix:.5})}vs(){if(this.Kt-this.Zt>.05*i.C){this.Zt=this.Kt;const t=i.k.Rt();if(t&&t.n!=this.ps?.xs){let s=t.n;s.startsWith("s_lbl_btn")&&(s=s.substring(6));const i=W.next[s];i&&(this.ps&&W.move({n:this.ps.n,b:this.ps.b}),this.ps={xs:t.n,n:s,b:i.b},W.move({n:s,b:"fff"}))}else!t&&this.ps&&(W.move({n:this.ps.n,b:this.ps.b}),this.ps=null)}this.ps&&i.F.wt(i.F.ht.Wt,!0)&&this.ys()}Vt(){this.states.note?this.states.note=null:this.ys()}bs(){return[i.Yt.CLOSING,i.Yt.OPENING].includes(this.states.ts)}gs(t){this.states.ts==i.Yt.CLOSED||this.bs()?t?.():(this.states.ts=i.Yt.CLOSING,W.move({n:"dl",x:-this.us,a:2e3}),W.move({n:"drg",x:this.us,a:2e3,onAnimDone:()=>{this.states.ts=i.Yt.CLOSED,t?.()}}))}ws(t){this.states.ts==i.Yt.OPEN||this.bs()?t?.():(this.states.ts=i.Yt.OPENING,W.move({n:"dl",x:-this.fs,a:2e3}),W.move({n:"drg",x:this.fs,a:2e3,onAnimDone:()=>{this.states.ts=i.Yt.OPEN,t?.()}}))}_s(t){if(t)if(t.n.startsWith("s_note"))this.states.note=t.n;else if(t.n.startsWith("btn")&&this.states.ss==i.Yt.IDLE){if(i.Audio.play(i.Audio.tt),this.states.hs=Number(t.n.substring(3)),this.states.es==this.states.hs)return void this.gs();this.states.ss=i.Yt.qt,this.gs((()=>{this.Ms(i.jt.Qt)}))}}zs(){this.As=this.As||this.Kt;const t=this.states.hs-this.states.es,s=1.25*Math.abs(t)*i.C,e=(this.Kt-this.As)/s;return 0==e&&(this.Os={x:W.next.camera.x,y:W.next.camera.y,z:W.next.camera.z}),this.Es(this.states.es+Math.floor(e*t)),e>1?(W.camera(this.Os),i.Audio.play(i.Audio.st),this.states.es=this.states.hs,this.ws((()=>{this.states.ss=i.Yt.IDLE})),!0):(W.camera({x:this.Os.x+(2*Math.random()-1)/300,y:this.Os.y+(2*Math.random()-1)/300,z:this.Os.z+(2*Math.random()-1)/300}),!1)}Ts(){i.k.Tt=!0,this.As=this.As||this.Kt;const t=(this.Kt-this.As)/(3*i.C);0==t&&this.gs();const s={z:0,rx:0,ry:0};return t>1?(W.camera(s),i.k.Tt=!1,document.getElementById("p").hidden=!1,delete W.next.title,delete W.current.title,!0):(s.z=-.5*(1-Math.sin(t*Math.PI/2)),W.camera(s),!1)}Ns(){i.k.Tt=!0,this.As=this.As||this.Kt;const t=(this.Kt-this.As)/(3*i.C);return 0==t&&(document.getElementById("p").hidden=!0),t>=1||(W.camera({z:-.5,rx:0,ry:0}),!1)}ys(){if(this.ps){const t=W.next[this.ps.n];this._s(t)}}Es(t){W.move({n:"dis",t:i.B.X(t),mix:.25})}Ms(t){this.As=0,this.Xt=t}update(t){this.Kt+=t;let s=!0;if(this.Xt==i.jt.K?(this.Ns()&&this.Ms(i.jt.Ht),s=!1):this.Xt==i.jt.Ht?(this.Ts()&&this.Ms(i.jt.Jt),s=!1):this.Xt==i.jt.Qt&&this.zs()&&this.Ms(i.jt.Jt),this.states.note){const t=i.B.U[this.states.note];i.k.Pt(t),i.F.wt(i.F.ht.Wt,!0)&&(this.states.note=null)}else s&&this.states.ss==i.Yt.IDLE&&this.vs()}};