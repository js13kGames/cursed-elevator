pxtex=(t,s,i,e,h=10,n=10,o=10,r=t.getContext`2d`,W,l,a=Math.random)=>{for(t.width=n,t.height=o,W=n;W--;)for(l=o;l--;)r.fillStyle=`hsl(${s+(a()-.5)*h},${i+(a()-.5)*h}%,${e+(a()-.5)*h}%)`,r.fillRect(W,l,1,1)},W={o:{},reset:s=>{W.canvas=s,W.objs=0,W.current={},W.next={},W.W={},W.l=!1,W.gl=s.getContext("webgl2"),W.gl.blendFunc(770,771),W.gl.activeTexture(33984),W.program=W.gl.createProgram(),W.gl.enable(2884),W.gl.shaderSource(t=W.gl.createShader(35633),"#version 300 es\nprecision highp float;in vec4 pos, col, uv;uniform mat4 pv, eye, m, im;uniform vec4 bb;out vec4 v_pos, v_col, v_uv;void main() {gl_Position = pv * (v_pos = bb.z > 0.? m[3] + eye * pos * bb: m * pos);v_col = col;v_uv = uv;}"),W.gl.compileShader(t),W.gl.attachShader(W.program,t),W.gl.shaderSource(t=W.gl.createShader(35632),"#version 300 es\nprecision highp float;const lowp float floatMax = float(uint(-1));in vec4 v_pos, v_col, v_uv;uniform vec4 light;uniform vec4 o;uniform sampler2D sampler;uniform uvec2 s;out vec4 c;highp uint rand(highp uint seed) {seed = seed ^ (seed << 13u);seed = seed ^ (seed >> 7u);seed = seed ^ (seed << 17u);return seed;}void main() {float ambient = o.z;vec3 light_dir = normalize(light.xyz - v_pos.xyz);vec3 normal = normalize(cross(dFdx(v_pos.xyz), dFdy(v_pos.xyz)));float lambert = light.w * max(0., dot(light_dir, normal)) * 0.7;float specular = 0.;if(o.x > 0.) {vec3 R = reflect(-light_dir, normal);vec3 V = normalize(-v_pos.xyz);float specAngle = max(dot(R, V), 0.);specular = light.w * pow(specAngle, o.x) * 0.3;}c = mix(texture(sampler, v_uv.xy), v_col, o.w);float f = o.y > 0. ? ambient + lambert + specular : 1.;c = vec4(c.rgb * f, c.a);lowp float relX = (v_pos.x + 1.0) * 0.5;lowp float relY = (v_pos.y + 1.0) * 0.5;uint pxRows = uint(ceil(relY * float(s.y)));highp uint index = pxRows * s.x + uint(relX * float(s.x));highp uint seed1 = rand(index);highp uint seed2 = rand(seed1);highp uint seed3 = rand(seed2);lowp vec3 rnd = vec3(0.0);rnd.x += float(seed1) / floatMax;rnd.y += float(seed2) / floatMax;rnd.z += float(seed3) / floatMax;rnd /= 255.0;c.xyz += rnd;}"),W.gl.compileShader(t),W.gl.attachShader(W.program,t),W.gl.linkProgram(W.program),W.gl.useProgram(W.program),W.gl.clearColor(1,1,1,1),W.clearColor=t=>W.gl.clearColor(...W.u(t)),W.clearColor("fff"),W.gl.enable(2929),W.light({y:1,i:1}),W.camera({fov:30}),setTimeout(W.draw,16)},_:(t,s,i,e,h=[],n,o,r,l,a,d,u,c)=>{if(t.n||="o"+W.objs++,t.size&&(t.w=t.h=t.d=t.size),t.t?.width&&!W.W[t.t.id]&&(i=W.gl.createTexture(),W.gl.pixelStorei(37441,!0),W.gl.bindTexture(3553,i),W.gl.pixelStorei(37440,1),W.gl.texImage2D(3553,0,6408,6408,5121,t.t),W.gl.generateMipmap(3553),W.W[t.t.id]=i),t.fov){const s=1/Math.tan(t.fov*Math.PI/180),i=.1,e=80,h=e-i;W.projection=new DOMMatrix([s/(W.canvas.width/W.canvas.height),0,0,0,0,s,0,0,0,0,-(e+i)/h,-1,0,0,-2*e*i/h,0])}t={type:s,...W.current[t.n]=W.next[t.n]||{w:1,h:1,d:1,x:0,y:0,z:0,rx:0,ry:0,rz:0,b:"888",mix:0},...t,f:0},W.o[t.type]?.vertices&&!W.o?.[t.type].verticesBuffer&&(W.gl.bindBuffer(34962,W.o[t.type].verticesBuffer=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array(W.o[t.type].vertices),35044),W.o[t.type].p||W.smooth(t),W.o[t.type].p&&(W.gl.bindBuffer(34962,W.o[t.type].normalsBuffer=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array(W.o[t.type].p.flat()),35044))),W.o[t.type]?.uv&&!W.o[t.type].uvBuffer&&(W.gl.bindBuffer(34962,W.o[t.type].uvBuffer=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array(W.o[t.type].uv),35044)),W.o[t.type]?.indices&&!W.o[t.type].indicesBuffer&&(W.gl.bindBuffer(34963,W.o[t.type].indicesBuffer=W.gl.createBuffer()),W.gl.bufferData(34963,new Uint16Array(W.o[t.type].indices),35044)),t.t?t.t&&!t.mix&&(t.mix=0):t.mix=1,W.next[t.n]=t},draw:(t,s,i,e,h=[])=>{if(s=t-W.lastFrame,W.lastFrame=t,requestAnimationFrame(W.draw),W.l)W.onDraw(t);else{for(e in W.next.camera.g&&W.m(W.next[W.next.camera.g],s,1),i=W.animation("camera"),W.next?.camera?.g&&i.preMultiplySelf(W.next[W.next.camera.g].v),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.program,"eye"),!1,i.toFloat32Array()),i.invertSelf(),i.preMultiplySelf(W.projection),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.program,"pv"),!1,i.toFloat32Array()),W.gl.uniform2ui(W.gl.getUniformLocation(W.program,"s"),W.canvas.width,W.canvas.height),W.gl.clear(16640),W.next){const t=W.next[e];t.t||1!=W.u(t.b)[3]?h.push(t):W.m(t,s)}for(e of(h.sort(((t,s)=>W.M(s)-W.M(t))),W.gl.enable(3042),h))["plane","billboard"].includes(e.type)&&W.gl.depthMask(0),W.m(e,s),W.gl.depthMask(1);W.gl.disable(3042),W.gl.uniform4f(W.gl.getUniformLocation(W.program,"light"),W.O("light","x"),W.O("light","y"),W.O("light","z"),W.O("light","i")),W.onDraw(t)}},m:(t,s,i=["camera","light","group"].includes(t.type),e)=>{t.t&&(W.gl.bindTexture(3553,W.W[t.t.id]),W.gl.uniform1i(W.gl.getUniformLocation(W.program,"sampler"),0)),t.f>=t.a?(t.onAnimDone?.(),delete t.a,delete t.onAnimDone):t.f<t.a&&(t.f+=s),t.f>t.a&&(t.f=t.a),W.next[t.n].v=W.animation(t.n),W.next[t.g]&&W.next[t.n].v.preMultiplySelf(W.next[t.g].v),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.program,"m"),!1,W.next[t.n].v.toFloat32Array()),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.program,"im"),!1,DOMMatrix.fromMatrix(W.next[t.n].v).invertSelf().toFloat32Array()),i||(W.gl.bindBuffer(34962,W.o[t.type].verticesBuffer),W.gl.vertexAttribPointer(e=W.gl.getAttribLocation(W.program,"pos"),3,5126,!1,0,0),W.gl.enableVertexAttribArray(e),W.o[t.type].uvBuffer&&(W.gl.bindBuffer(34962,W.o[t.type].uvBuffer),W.gl.vertexAttribPointer(e=W.gl.getAttribLocation(W.program,"uv"),2,5126,!1,0,0),W.gl.enableVertexAttribArray(e)),W.gl.uniform4f(W.gl.getUniformLocation(W.program,"o"),t.s,t.ns?0:1,W.ambientLight||.2,t.mix),W.gl.uniform4f(W.gl.getUniformLocation(W.program,"bb"),t.w,t.h,"billboard"==t.type,0),W.o[t.type].indicesBuffer&&W.gl.bindBuffer(34963,W.o[t.type].indicesBuffer),W.gl.vertexAttrib4fv(W.gl.getAttribLocation(W.program,"col"),W.u(t.b)),W.o[t.type].indicesBuffer?W.gl.drawElements(4,W.o[t.type].indices.length,5123,0):W.gl.drawArrays(4,0,W.o[t.type].vertices.length/3))},O:(t,s)=>{const i=W.next[t];if(!i?.a)return i[s];const e=W.current[t];return e[s]+(i[s]-e[s])*(i.f/i.a)},animation:(t,s=new DOMMatrix)=>W.next[t]?s.translateSelf(W.O(t,"x"),W.O(t,"y"),W.O(t,"z")).rotateSelf(W.O(t,"rx"),W.O(t,"ry"),W.O(t,"rz")).scaleSelf(W.O(t,"w"),W.O(t,"h"),W.O(t,"d")):s,M:(t,s=W.next.camera)=>t?.v&&s?.v?(s.v.m41-t.v.m41)**2+(s.v.m42-t.v.m42)**2+(s.v.m43-t.v.m43)**2:0,A:t=>W.ambientLight=t,u:t=>[...t.match(t.length<5?/./g:/../g).map((s=>("0x"+s)/(t.length<5?15:255))),1],add:(t,s)=>{W.o[t]=s,s.p&&(W.o[t].customNormals=1),W[t]=s=>W._(s,t)},group:t=>W._(t,"group"),move:t=>setTimeout((()=>{W._(t)}),1),delete:t=>setTimeout((()=>{delete W.next[t]}),1),camera:t=>setTimeout((()=>{W._(t,t.n="camera")}),1),light:t=>W._(t,t.n="light")},W.smooth=(t,s={},i=[],e,h,n,o,r,l,a,d,u,c,f)=>{for(W.o[t.type].p=[],n=0;n<W.o[t.type].vertices.length;n+=3)i.push(W.o[t.type].vertices.slice(n,n+3));for((e=W.o[t.type].indices)?h=1:(e=i,h=0),n=0;n<2*e.length;n+=3){o=n%e.length,r=i[d=h?W.o[t.type].indices[o]:o],l=i[u=h?W.o[t.type].indices[o+1]:o+1],a=i[c=h?W.o[t.type].indices[o+2]:o+2],AB=[l[0]-r[0],l[1]-r[1],l[2]-r[2]],BC=[a[0]-l[0],a[1]-l[1],a[2]-l[2]],f=n>o?[0,0,0]:[AB[1]*BC[2]-AB[2]*BC[1],AB[2]*BC[0]-AB[0]*BC[2],AB[0]*BC[1]-AB[1]*BC[0]];const x=r[0]+"_"+r[1]+"_"+r[2],y=l[0]+"_"+l[1]+"_"+l[2],_=a[0]+"_"+a[1]+"_"+a[2];s[x]||=[0,0,0],s[y]||=[0,0,0],s[_]||=[0,0,0],W.o[t.type].p[d]=s[x]=s[x].map(((t,s)=>t+f[s])),W.o[t.type].p[u]=s[y]=s[y].map(((t,s)=>t+f[s])),W.o[t.type].p[c]=s[_]=s[_].map(((t,s)=>t+f[s]))}},W.add("plane",{vertices:[.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[1,1,0,1,0,0,1,1,0,0,1,0]}),W.add("billboard",W.o.plane),W.add("cube",{vertices:[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5],uv:[1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0]}),W.cube=t=>W._(t,"cube");let s=new AudioContext;"use strict";const i={T:'"Courier New", monospace',k:"Arial, sans-serif",S:'"Times New Roman", serif',N:30,D:60,I:"Cursed Elevator",R(t){if(!t.g)return t;const s=W.next[t.g];return{x:s.x+t.x,y:s.y+t.y,z:s.z+t.z,w:t.w,h:t.h}},init(){i.F.C((()=>{i.P.init(),i.L.init()}))},K(){const t=localStorage.getItem("2024_sd_elevator.save");return t?JSON.parse(t):null},B(t){localStorage.setItem("2024_sd_elevator.save",JSON.stringify({level:t}))}};window.addEventListener("load",(()=>i.init())),i.F={U:{s_note1:["I'm leaving this note for whoever gets lost","here as well. You are now stuck in a cursed","elevator. But if I'm not in here (and neither","my dead body), I must've made it out!","","Don't worry, I'm going to leave you some","tips as I figure this situation out!"],s_note2:["Everything went black and now it's 1 again.","My note is also gone.","","There is a fellow on floor 3, seems harmless."],s_note3:["Back again, last note gone again.","Floor 7 is new."],s_note4:["Found a note book with torn pages. I guess","this is from that note writter.","","Lets continue the tradition...","","Here's a survival tip: You can close the doors.",'Hit the "><" button or go to another floor.'],s_note5a:new Array(24).fill("NO MORE REPEATS NO MORE REPEATS"),s_note5b:["SICK OF PAIN SICK OF PAIN SICK OF","PAIN SO SICK OF PAIN! NO MORE BITING!","STAY HERE, KEEP THE DOORS CLOSED","FOREVER? OR CAN I HIDE BETTER IN","THE DARK?"],s_note5c:["WHERE IS THE BUTTON?!"],s_note6:["Lost note book. Is 1 the way out?","Hope"],blue1:["Please go. Leave me alone."],blue2:["Go! Don't let it find me."],blue3:["not...alone"],blue4:["It won't find me here, right? Why come back?","Oh, it smells rotten... Please go. Leave me alone."],pink1:["Join us? Safe together. Step out the elevator.","Let us huddle together."],pink2:["Offer still stands. Always welcome."]},W:{},G(){for(let t=0;t<14;t++){const s="s_lbl_btn"+t,e=0==t?"><":String(t).padStart(2,"0"),[h,n]=i.L.H(100,70,s);n.font="600 32px "+i.k,n.textBaseline="middle",n.fillStyle="#444",n.fillText(e,50,37),this.W[s]=h}},V(){const t=Math.round(70.7),s=i.L.H(50,t,"paper")[0];pxtex(s,0,0,95,3,50,t),this.W.$=s},J(){const t=i.L.H(200,300,"wall")[0];pxtex(t,0,0,20,3,200,300),this.W.Y=t;const s=i.L.H(100,100,"ceil")[0];pxtex(s,0,0,100,3,100,100),this.W.ceil=s;const e=i.L.H(100,100,"floor")[0];pxtex(e,0,0,10,1,100,100),this.W.floor=e;const h=i.L.H(40,300,"fs")[0];pxtex(h,0,0,20,3,40,300),this.W.X=h;const n=i.L.H(200,75,"ft")[0];pxtex(n,0,0,20,3,200,75),this.W.j=n},q(){const t=Math.round(120),[s,e]=i.L.H(600,t,"title");e.fillStyle="#f00",e.font="600 64px "+i.S,e.fillText(i.I,300,t/2),this.W.title=s},Z(t,s){const e="audio:"+t+s;if(this.W[e])return this.W[e];const h=Math.round(100),[n,o]=i.L.H(200,h,e);return o.fillStyle="#"+s,o.font="36px "+i.k,o.textBaseline="middle",o.fillText(String(t),100,h/2+6),this.W[e]=n,n},tt(t){const s="dis:"+t;if(this.W[s])return this.W[s];const e=200,h=Math.round(100),[n,o]=i.L.H(e,h,s);return o.fillStyle="#f00",o.fillRect(0,0,e,h),o.fillStyle="#fff",o.font="600 64px "+i.T,o.textBaseline="middle",o.fillText(String(t),100,h/2+6),this.W[s]=n,n},st(t,s){const e="eyes:"+t+s;if(this.W[e])return this.W[e];const[h,n]=i.L.H(200,50,e);return n.fillStyle="#"+s,n.font="600 42px "+i.T,n.textBaseline="middle",n.fillText(String(t),100,25),this.W[e]=h,h},C(t){this.q(),this.G(),this.J(),this.V(),t()}},i.Audio={it:[.3,0,626,,.01,.01,,2.2,,,,,,,,.1,.01,.79,.02],et:[1.5,0,783.99,.07,,1.6,1,2,,,,,,,,,,.3,.15],ht:[.3,0,164.8138,.2,1.1,.2,3,4,,,,,,,,.1,,,.5,,-562],nt:[.1,0,146.8324,.2,2,.3,1,2,,,,,,3],ERROR:[.3,0,71,,.02,.05,3,.2,,68,,,,,,,.01,.96,.02,,389],ot:[.2,0,453,,.07,.008,4,1.6,-6,-2,,,,.4,,.4,.02,.55,.04,,1424],rt:[.5,0,427,.01,.02,.02,1,3.7,,12,138,.03,,.1,180,1,,.97,.01],Wt:[2.1,0,453,.03,.03,.16,4,3.7,-1,,,,,.2,1.3,.2,.1,.52,.07],play(t,i,e){t=t.slice(),i&&(t[5]=i-(t[3]||0)-(t[5]||0)-(t[18]||0)),e&&(t[0]=e),((t=1,i=.05,e=220,h=0,n=0,o=.1,r=0,W=1,l=0,a=0,d=0,u=0,c=0,f=0,x=0,y=0,_=0,p=1,g=0,b=0,m=0)=>{let w=Math,v=2*w.PI,z=44100,M=l*=500*v/z/z,E=e*=(1-i+2*i*w.random(i=[]))*v/z,O=0,A=0,T=0,k=1,S=0,N=0,D=0,I=m<0?-1:1,R=v*I*m*2/z,C=w.cos(R),F=w.sin,P=F(R)/4,L=1+P,K=-2*C/L,B=(1-P)/L,U=(1+I*C)/2/L,G=-(I+C)/L,H=U,V=0,$=0,J=0,Y=0;for(a*=500*v/z**3,x*=v/z,d*=v/z,u*=z,c=z*c|0,t*=.3,I=(h=z*h+9)+(g*=z)+(n*=z)+(o*=z)+(_*=z)|0;T<I;i[T++]=D*t)++N%(100*y|0)||(D=r?1<r?2<r?3<r?F(O**3):w.max(w.min(w.tan(O),1),-1):1-(2*O/v%2+2)%2:1-4*w.abs(w.round(O/v)-O/v):F(O),D=(c?1-b+b*F(v*T/c):1)*(D<0?-1:1)*w.abs(D)**W*(T<h?T/h:T<h+g?1-(T-h)/g*(1-p):T<h+g+n?p:T<I-_?(I-T-_)/o*p:0),D=_?D/2+(_>T?0:(T<I-_?1:(I-T)/_)*i[T-_|0]/2/t):D,m&&(D=Y=H*V+G*(V=$)+U*($=D)-B*J-K*(J=Y))),R=(e+=l+=a)*w.cos(x*A++),O+=R+R*f*F(T**5),k&&++k>u&&(e+=d,E+=d,k=0),!c||++S%c||(e=E,l=M,k=k||1);(t=s.createBuffer(1,I,z)).getChannelData(0).set(i),(e=s.createBufferSource()).buffer=t,e.connect(s.destination),e.start()})(...t)},text(t,s,e,h){const n=i.F.Z(t,s),o=.01*e;W.plane({n:n.id,g:h.g,x:h.x,y:h.y+.05,z:h.z+.1,w:.5,h:.25,t:n,ns:1}),W.move({n:n.id,y:h.y+.05+o,a:1e3*e,onAnimDone:()=>W.delete(n.id)})}},i.P={lt:{dt:1,ut:2,ct:3,ft:10,xt:11,yt:12,_t:13},gt:{},bt:{},wt:{},vt:{},zt(){this.Mt={[this.lt.dt]:{keyboard:["Escape"]},[this.lt.xt]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"]},[this.lt.ft]:{keyboard:["ArrowLeft","KeyA","KeyQ"]},[this.lt._t]:{keyboard:["ArrowDown","KeyS"]},[this.lt.yt]:{keyboard:["ArrowRight","KeyD"]},[this.lt.ut]:{keyboard:["KeyE","Enter"]}}},Et(){let t=0,s=0;return this.Ot(this.lt.ft)?t=-1:this.Ot(this.lt.yt)&&(t=1),this.Ot(this.lt.xt)?s=-1:this.Ot(this.lt._t)&&(s=1),{x:t,y:s}},At(t){return this.Mt[t]},init(){this.zt(),this.Tt()},Ot(t,s){const i=this.At(t);for(const t of i.keyboard)if(this.kt(t,s))return!0;return!1},kt(t,s){const i=this.vt[t];return!(!i||!i.time)&&(s&&(i.time=0,i.St=!0),!0)},Nt(t,s){const i=this.bt[t]||[];i.push(s),this.bt[t]=i},Dt(t,s){const i=this.wt[t]||[];i.push(s),this.wt[t]=i},Tt(){document.body.onkeydown=t=>{const s=this.vt[t.code];s&&s.St||(this.vt[t.code]={time:Date.now()},this.bt[t.code]&&this.bt[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.vt[t.code]={time:0},this.wt[t.code]&&this.wt[t.code].forEach((t=>t()))}}},i.L={camera:{rx:0,ry:0},It:!1,Rt:null,Ct:null,Ft:null,Pt:null,Lt:new DOMPoint(0,0,-1),Kt:0,Bt(){let t=[];const s=this.Ut(),i={min:[],max:[]};for(const e in W.next){if(!e.startsWith("s_"))continue;const h=W.next[e];let n=0;if("plane"!=h.type&&"billboard"!=h.type&&(n=h.d),i.min[0]=h.x-h.w/2,i.min[1]=h.y-h.h/2,i.min[2]=h.z-n/2,h.g){const t=W.next[h.g];i.min[0]+=t.x,i.min[1]+=t.y,i.min[2]+=t.z}i.max[0]=i.min[0]+h.w,i.max[1]=i.min[1]+h.h,i.max[2]=i.min[2]+n,90!=h.ry&&-90!=h.ry||(i.min[0]-=h.w/2,i.max[0]+=h.w/2,i.min[2]-=h.w/2,i.max[2]+=h.w/2);const o=this.Gt(s,i);o&&t.push([h,o])}const e=this.Ht(s.origin,t);return!e?.n.startsWith("s__")&&e},Vt(t,s){const e=Math.round(Math.min(735.28,window.innerHeight-40)),h=(this.Ct.width-520)/2,n=(this.Ct.height-e)/2;this.Pt.drawImage(i.F.W.$,h,n,520,e),this.Pt.fillStyle=s||"#000",this.Pt.font="24px "+i.k,this.Pt.textAlign="left",this.Pt.textBaseline="top";for(let s=0;s<t.length;s++)this.Pt.fillText(t[s],h+20,n+20+29*s)},$t(){this.Pt.fillStyle="#00000070",this.Pt.fillRect(0,0,this.Ct.width,this.Ct.height),this.Pt.fillStyle="#fff",this.Pt.font="96px "+i.S,this.Pt.textAlign="center",this.Pt.fillText("PAUSED",this.Ct.width/2,this.Ct.height/2)},Ht(t,s){if(1==s.length)return s[0][0];let i=null,e=1/0;for(let h=0;h<s.length;h++){const n=s[h][1],o=[n[0]-t[0],n[1]-t[1],n[2]-t[2]],r=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]);r<e&&(i=s[h][0],e=r)}return i},H(t,s,i){const e=document.createElement("canvas");e.width=t,e.height=s,i&&(e.id=i);const h=e.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,h.textAlign="center",[e,h]},Ut(){const t=W.next.camera,s=(new DOMMatrix).rotateSelf(t.rx,t.ry,t.rz),i={origin:[t.x,t.y,t.z],dir:this.Lt.matrixTransform(s)};return i.dir=[i.dir.x,i.dir.y,i.dir.z],i},init(){this.Rt=document.getElementById("c"),this.Ct=document.getElementById("ui"),this.Pt=this.Ct.getContext("2d",{alpha:!0}),this.Pt.imageSmoothingEnabled=!1,this.resize(),W.onDraw=this.update.bind(this),W.reset(this.Rt),W.clearColor("000"),W.A(.2),this.Tt(),this.level=new i.Jt},Gt(t,s){let i=!0,e=[],h=[],n=[],o=[];for(let h=0;h<3;h++)t.origin[h]<s.min[h]?(e[h]=1,n[h]=s.min[h],i=!1):t.origin[h]>s.max[h]?(e[h]=0,n[h]=s.max[h],i=!1):e[h]=2;if(i)return t.origin;for(let s=0;s<3;s++)2!=e[s]&&0!=t.dir[s]?h[s]=(n[s]-t.origin[s])/t.dir[s]:h[s]=-1;let r=0;for(let t=1;t<3;t++)h[r]<h[t]&&(r=t);if(h[r]<0)return null;for(let i=0;i<3;i++)if(r!=i){if(o[i]=t.origin[i]+h[r]*t.dir[i],o[i]<s.min[i]||o[i]>s.max[i])return null}else o[i]=n[i];return o},pause(){this.l=!0,document.body.classList.add("p"),W.l=!0},Tt(){this.Yt=null,this.Xt=null;window.addEventListener("resize",(t=>this.resize()));const t=i.P.At(i.P.lt.dt),s=()=>{this.jt(),this.Yt=null,this.Xt=null};t.keyboard.forEach((t=>i.P.Dt(t,s))),this.Rt.addEventListener("mousedown",(t=>{0===t.button&&this.level&&this.level.qt()})),this.Rt.addEventListener("mouseenter",(t=>{this.level&&!this.It&&(this.Yt=t.clientX,this.Xt=t.clientY)})),this.Rt.addEventListener("mousemove",(t=>{if(this.level&&!this.l&&!this.It){if(null===this.Yt)return this.Yt=t.clientX,void(this.Xt=t.clientY);this.camera.rx-=.4*(t.clientY-this.Xt),this.camera.ry-=.4*(t.clientX-this.Yt),this.camera.rx=Math.min(80,Math.max(-60,this.camera.rx)),this.camera.ry=this.camera.ry%360,W.camera(this.camera),this.Yt=t.clientX,this.Xt=t.clientY}})),i.P.Dt("KeyR",(()=>{this.It||(this.camera.rx=0,this.camera.ry=0,W.camera(this.camera))}))},resize(){const t=4/3;let s=window.innerWidth,i=window.innerHeight;s>i?(i-=40,s=Math.round(Math.min(s,i*t))):s<i&&(s-=40,i=Math.round(Math.min(i,s*t))),this.Rt.width=s,this.Rt.height=i,this.Ct.width=s,this.Ct.height=i,W.next?.camera&&(W.camera({fov:W.next.camera.fov}),W.gl.viewport(0,0,s,i))},jt(){this.l?this.unpause():this.pause()},unpause(){this.l=!1,document.body.classList.remove("p"),W.l=!1},update(t=0){if(t&&this.Qt){const s=(t-this.Qt)/(1e3/i.D);if(this.Pt.clearRect(0,0,this.Ct.width,this.Ct.height),this.Pt.imageSmoothingEnabled=!1,this.Pt.fillStyle="#fff",this.Pt.font="11px monospace",this.Pt.textAlign="left",this.Pt.fillText(~~(i.D/s)+" FPS",10,20),this.l)return void this.$t();if(this.Kt+=s,this.level.update(s),!this.It){const t=.3;i.P.Ot(i.P.lt.xt)?this.camera.rx+=t:i.P.Ot(i.P.lt._t)&&(this.camera.rx-=t),i.P.Ot(i.P.lt.ft)?this.camera.ry+=t:i.P.Ot(i.P.lt.yt)&&(this.camera.ry-=t),this.camera.rx=Math.min(80,Math.max(-60,this.camera.rx)),this.camera.ry=this.camera.ry%360,W.camera(this.camera)}}this.Qt=t}},i.Zt={ts:0,I:1,ss:2,es:3,hs:4,os:5,rs:6},i.Ws={OPEN:1,OPENING:2,CLOSED:3,CLOSING:4,IDLE:5,ls:6},i.Jt=class{constructor(){this.ds=0,this.us=!0,this.cs=[],this.Kt=0,this.fs=[],this.xs=0,this.ys=i.Ws.OPEN,this._s=i.Ws.IDLE,this.ps=8,this.gs=this.ps,this.bs=[],this.ws=1,this.loop=5,this.vs=2.5,this.zs=3,this.Ms=2,W.light({y:this.zs/2-.2}),W.plane({n:"title",z:-200,w:1,h:.2,b:"f00",t:i.F.W.title}),W.group({n:"ev"}),this.Es(),this.Os(),this.As(),this.Ts(),this.ks(),this.Ss(),this.Ns(),this.Ds(this.ps),this.Is(this.loop),this.Rs(this.ps),document.getElementById("b").remove()}As(){const t="display";W.group({n:t,g:"ev",y:this.zs/2-.25-.15,z:-this.Ms/2+.06}),W.plane({g:t,n:"dis",w:.5,h:.25,b:"f00"})}Os(){const t=this.vs/2,s=.05;this.Cs=t/2+.0025,this.Fs=this.Cs+this.vs/2-this.vs/3.5,W.group({n:"dlg",g:"ev",x:-this.Fs,z:-this.Ms/2}),W.cube({g:"dlg",w:t,h:this.zs,d:s,b:"aaa",s:20}),W.plane({n:"dsl",g:"dlg",b:"0008",y:-this.zs/2-.001,z:-.27,h:100,rx:-90,ry:20,ns:1}),W.group({n:"drg",g:"ev",x:this.Fs,z:-this.Ms/2}),W.cube({g:"drg",w:t,h:this.zs,d:s,b:"aaa",s:20}),W.plane({n:"dsr",g:"drg",b:"0008",y:-this.zs/2-.001,z:-.27,h:100,rx:-90,ry:-20,ns:1}),this.Ps=t/4,W.plane({n:"s_note1",g:"drg",x:(this.Ps-t)/2+.1,y:-.1,z:.025+.001,w:this.Ps,h:1.414*this.Ps,rz:-10,t:i.F.W.$})}Ts(){const t="pad";W.group({n:t,g:"ev",x:this.vs/2-.3,y:-.175,z:-this.Ms/2+.051}),W.plane({g:t,w:.3,h:.7,b:"bbb",s:20});const s=.02,e=.1,h=.07,n=(e+s)/2;for(let o=0;o<14;o++){const r="btn"+o,l=o%2*(s+e)-n,a=~~(o/2)*(s+h)-.27,d=i.F.W["s_lbl_"+r];W.cube({g:t,n:r,x:l,y:a,w:e,h,d:.02,b:"ddd"}),W.plane({g:t,n:"s_lbl_"+r,x:l,y:a,z:.011,w:e,h,t:d}),13==o&&(this.Ls=JSON.parse(JSON.stringify(W.next[r])),this.Ks=JSON.parse(JSON.stringify(W.next["s_lbl_"+r])),this.Ks.t=d)}delete this.Ls.v,delete this.Ks.v}Es(){const t="ev";W.group({n:t,g:"ev"}),W.plane({g:t,y:-this.zs/2,w:this.vs,h:this.Ms,rx:-90,b:"333",t:i.F.W.floor,mix:.5}),W.plane({g:t,y:this.zs/2,w:this.vs,h:this.Ms,rx:90,b:"bbb",t:i.F.W.ceil,mix:.5}),W.plane({g:t,x:-this.vs/2,ry:90,w:this.Ms,h:this.zs,b:"999",t:i.F.W.Y,s:30,mix:.5}),W.plane({g:t,x:this.vs/2,ry:-90,w:this.Ms,h:this.zs,b:"999",t:i.F.W.Y,s:30,mix:.5}),W.plane({g:t,z:this.Ms/2,ry:180,w:this.vs,h:this.zs,b:"999",t:i.F.W.Y,s:30,mix:.5}),W.cube({g:t,x:-this.vs/2+.02,y:-this.zs/5,z:.025,w:.04,h:.15,d:this.Ms-.15,b:"aaa",s:30}),W.cube({g:t,x:this.vs/2-.02,y:-this.zs/5,z:.025,w:.04,h:.15,d:this.Ms-.15,b:"aaa",s:30}),W.cube({g:t,y:-this.zs/5,z:this.Ms/2-.02,w:this.vs-.15,h:.15,d:.04,b:"aaa",s:30}),W.cube({g:t,n:"s__fl",x:-(this.vs-this.vs/4.5)/2,z:-this.Ms/2,w:this.vs/4.5,h:this.zs,d:.1,b:"999",t:i.F.W.X,s:30,mix:.5}),W.cube({g:t,n:"s__fr",x:(this.vs-this.vs/4.5)/2,z:-this.Ms/2,w:this.vs/4.5,h:this.zs,d:.1,b:"999",t:i.F.W.X,s:30,mix:.5}),W.cube({g:t,y:(this.zs-this.zs/4)/2,z:-this.Ms/2,w:this.vs,h:this.zs/4,d:.1,b:"999",t:i.F.W.j,s:30,mix:.5})}ks(){W.plane({n:"plane",y:-this.zs/2-.002,z:-this.Ms/2-10,w:30,h:20,rx:90,rz:180,b:"111"}),W.plane({n:"e_red",y:.8,z:100,w:.5,h:.125,t:i.F.st("•   •","f00"),ns:1}),W.plane({n:"e_blue",x:.6,y:-.4,z:100,w:.5,h:.125,rx:30,ry:-45,t:i.F.st("•  •","77f"),ns:1}),W.group({n:"e_pink_all",z:100}),W.plane({g:"e_pink_all",n:"e_pink1",x:.4,y:.6,w:.7,h:.175,t:i.F.st("•   •","f2c"),ns:1}),W.plane({g:"e_pink_all",n:"e_pink2",x:.7,y:.2,w:.5,h:.125,ry:20,t:i.F.st("•  •","f2c")}),W.plane({g:"e_pink_all",n:"e_pink3",x:.9,y:-.1,w:.5,h:.125,ry:20,t:i.F.st("•   •","f2c")}),W.plane({g:"e_pink_all",n:"e_pink4",x:1.3,y:.1,w:.4,h:.1,ry:20,rx:-10,t:i.F.st("•  •","f2c")}),W.plane({g:"e_pink_all",n:"e_pink5",x:-.5,y:.3,w:.5,h:.125,ry:-20,t:i.F.st("•  •","f2c")}),W.plane({g:"e_pink_all",n:"e_pink6",x:-.8,w:.4,h:.1,ry:-20,t:i.F.st("•   •","f2c")}),W.plane({g:"e_pink_all",n:"e_pink7",x:-1.2,y:.2,w:.6,h:.15,ry:-20,t:i.F.st("•  •","f2c")}),W.plane({g:"e_pink_all",n:"e_pink8",x:-1.4,y:-.2,w:.5,h:.125,ry:-20,t:i.F.st("•   •","f2c")})}Ns(){const t="fff",s=.005;W.group({n:"hl"}),W.cube({n:"hl_t",g:"hl",size:s,b:t,ns:1}),W.cube({n:"hl_r",g:"hl",size:s,b:t,ns:1}),W.cube({n:"hl_b",g:"hl",size:s,b:t,ns:1}),W.cube({n:"hl_l",g:"hl",size:s,b:t,ns:1})}Ss(){[this.Bs,this.Us]=i.L.H(120,60,"loops"),this.Us.font="48px "+i.S,this.Us.fillStyle="#999",this.Us.textAlign="left",this.Us.textBaseline="top",this.Us.fillText("𝍪",0,0),W.plane({n:"loops",g:"drg",x:-.47,y:.4,z:100,w:.2,h:.1,rz:5,t:this.Bs})}Gs(){if(this.Kt-this.ds>.05*i.D){this.ds=this.Kt;const t=i.L.Bt();if(t&&t.n!=this.Vs?.Hs){let s=t.n;s.startsWith("s_lbl_btn")&&(s=s.substring(6));W.next[s]&&(this.Vs={Hs:t.n,n:s})}else!t&&this.Vs&&(this.Vs=null)}if(this.$s(this.Vs),this.Vs){if(this.Js(this.Vs.n)){const t=i.L.Ct,s=i.L.Pt;s.fillStyle="#fff",s.font="20px "+i.T,s.textAlign="center",s.fillText("[E]/LEFT-CLICK TO SELECT",t.width/2,t.height-42)}i.P.Ot(i.P.lt.ut,!0)&&this.Ys()}}qt(){this.note?this.note=null:this.Ys()}Xs(t){const s=this.loop,e=this.fs.includes(13);let h=i.Zt.ts;if(1==s)13==t&&(h=i.Zt.hs);else if(2==s)e||this.js(13),3==t?W.move({n:"e_blue",rx:0,ry:0,a:500,onAnimDone:()=>{this.cs.push({duration:2,qs:t=>(this.Qs(i.F.U.blue1,W.next.e_blue,"77f",t),t>2||3!=this.ps)}),W.move({n:"e_blue",rx:30,ry:-45,a:2e3})}}):13==t&&(h=i.Zt.hs);else{if(3==s){if(!e&&this.Zs([3,9])&&this.js(13),3==t){const t={x:W.next.e_blue.x,y:W.next.e_blue.y,z:W.next.e_blue.z,h:W.next.e_blue.h};this.cs.push({duration:2,qs:s=>(this.Qs(i.F.U.blue2,t,"77f",s),W.move({n:"e_blue",x:t.x+(Math.random()-.5)/60,y:t.y+(Math.random()-.5)/100}),this._s==i.Ws.ls)})}else if(9==t){const t=W.next.e_pink1.y;this.cs.push({duration:5,qs:t=>(this.Qs(i.F.U.pink1,W.next.e_pink1,"f2c",t),t>1)},{duration:10,qs:s=>{const e=(Math.sin(10*Math.PI*s)+1)/2;return W.move({n:"e_pink1",y:t-.025*e,rx:40*e}),s>1||this._s==i.Ws.ls}})}else 13==t&&(h=i.Zt.hs);return}if(4==s)!e&&this.Zs([3,6,9])&&this.js(13),3==t?this.cs.push({duration:2,qs:t=>(this.Qs(i.F.U.blue3,W.next.e_blue,"77f",t),t>1)}):9==t?this.cs.push({duration:2,qs:t=>(this.Qs(i.F.U.pink2,W.next.e_pink1,"f2c",t),t>1)}):13==t&&(h=i.Zt.hs);else if(5==s)if(3==t)this.cs.push({duration:5,qs:t=>(this.Qs(i.F.U.blue4,W.next.e_blue,"7ae",t),t>1)});else if(9==t){const t=[5,6,8].map((t=>{const s="e_pink"+t;return{n:s,x:W.next[s].x,y:W.next[s].y}}));this.cs.push({duration:2,qs:s=>(t.forEach((t=>{W.move({n:t.n,x:t.x+(Math.random()-.5)/60,y:t.y+(Math.random()-.5)/100})})),this._s==i.Ws.ls)});const{x:s,y:e,z:h}=W.next.e_red;W.move({n:"e_red",rx:0,ry:0,rz:0,a:600,onAnimDone:()=>{setTimeout((()=>this.ti(s,e,h)),1e3)}})}else 13==t?h=i.Zt.hs:8!=t&&this.bs.includes(9)&&Math.random()<.3&&(W.move({n:"e_red",x:0,y:.5,z:-3}),setTimeout((()=>this.ti(0,.5,-3)),1e3));else 6==s&&1==t&&(h=i.Zt.rs)}this.si(h)}ii(){return[i.Ws.CLOSING,i.Ws.OPENING].includes(this.ys)}ei(t){this.ys==i.Ws.CLOSED||this.ii()?t?.():(this.ys=i.Ws.CLOSING,i.Audio.play(i.Audio.ht),W.move({n:"dlg",x:-this.Cs,a:2e3}),W.move({n:"drg",x:this.Cs,a:2e3,onAnimDone:()=>{this.ys=i.Ws.CLOSED,setTimeout((()=>t?.()),800)}}))}hi(t){this.ys==i.Ws.OPEN||this.ii()?t?.():(this.ys=i.Ws.OPENING,setTimeout((()=>{i.Audio.play(i.Audio.ht),W.move({n:"dlg",x:-this.Fs,a:2e3}),W.move({n:"drg",x:this.Fs,a:2e3,onAnimDone:()=>{this.ys=i.Ws.OPEN,t?.()}})}),800))}js(t){this.fs.push(t),W.move({n:"btn"+t,b:"ddd"})}ni(t){if(this.ys==i.Ws.CLOSED){i.Audio.play(i.Audio.Wt),i.Audio.text("*thud*","f00",3,{x:0,y:.1,z:-1});const t={x:W.next.camera.x,y:W.next.camera.y,z:W.next.camera.z};return this.cs.push({duration:.7,qs:s=>(W.camera({x:t.x+(2*Math.random()-1)/300,y:t.y+(2*Math.random()-1)/300,z:t.z+(2*Math.random()-1)/300}),s>1)}),W.move({n:"e_red",z:100}),!0}return t>1&&(this.xs++,this.si(i.Zt.os),!0)}oi(t){if(t)if(t.n.startsWith("s_note"))this.note=t.n;else if(t.n.startsWith("btn")){if(!this.Js(t.n)&&5==this.loop&&"btn13"==t.n&&!this.ri)return this.ri=!0,W.move({n:"btn13",x:W.next.btn13.x-.2,y:W.next.btn13.y+.8,z:W.next.btn13.z+.7,rx:0,ry:0,rz:0,a:500,onAnimDone:()=>{setTimeout((()=>{this.Ls.a=1e3,this.Ls.onAnimDone=()=>this.js(13),this.Ks.a=1e3,W.move(this.Ls),W.move(this.Ks)}),200)}}),void W.move({n:"s_lbl_btn13",x:W.next.s_lbl_btn13.x-.2,y:W.next.s_lbl_btn13.y+.8,z:W.next.s_lbl_btn13.z+.72,rx:0,ry:0,rz:0,a:500});if(this._s==i.Ws.IDLE){if(!this.Js(t.n))return void i.Audio.play(i.Audio.ERROR);i.Audio.play(i.Audio.it),i.Audio.text("*beep*","ff0",1,t);const s=Number(t.n.substring(3));if(0==s)return void this.ei();if(this.ps==s)return void(this.ys==i.Ws.OPEN?this.ei():this.hi());this.gs=s,this._s=i.Ws.ls,this.ei((()=>this.si(i.Zt.es)))}}}Zs(t){for(let s=0;s<t.length;s++)if(!this.bs.includes(t[s]))return!1;return!0}$s(t){if((!t||!this.Js(t.n))&&(!t||5!=this.loop||"btn13"!=t.n||this.ri))return void W.move({n:"hl",z:100});const s=W.next[t.n],e=i.R(s),h=.005;W.move({n:"hl",x:e.x,y:e.y,z:e.z+(s.ry?0:.01),rx:s.rx,ry:s.ry,rz:s.rz}),W.move({n:"hl_t",y:e.h/2,w:e.w,h}),W.move({n:"hl_r",x:e.w/2,h:e.h,w:h}),W.move({n:"hl_b",y:-e.h/2,w:e.w,h}),W.move({n:"hl_l",x:-e.w/2,h:e.h,w:h})}Js(t){return!t.startsWith("btn")||this.fs.includes(Number(t.replace("btn","")))}Wi(){return 2==this.loop&&13==this.ps||(3==this.loop&&13==this.ps||(4==this.loop&&9==this.ps||5==this.loop))}li(t){W.camera({x:0,y:0,z:0}),W.light({i:1}),this.loop=t,this.bs=[],this.ps=6==this.loop?13:1,this.gs=this.ps,this.Ds(this.ps),this.Is(t),this.Rs(this.ps),this.Vs=null}Rs(t){const s=this.loop,i={n:"e_red",y:.8,z:100},e={n:"e_blue",y:0,z:100,rx:0},h={n:"e_pink_all",z:100};if(1==s)13==t&&(i.z=-8);else if(2==s)3==t?e.z=-4:13==t&&(i.z=-5);else if(3==s)3==t?e.z=-4:9==t?h.z=-3:13==t&&(i.z=-2);else if(4==s){const s={n:"s_note4",z:100};3==t?(e.y=-1,e.z=-5,e.rx=-90):6==t?s.z=-2:9==t&&(h.z=-3,i.x=W.next.e_pink7.x,i.y=W.next.e_pink7.y,i.z=-3,W.move({n:"e_pink7",z:100})),W.move(s)}else if(5==s){let s=100;3==t?e.z=-3:9==t?this.bs.includes(9)||(h.z=-3,W.move({n:"e_pink5",x:-.5,y:.2,ry:-30}),W.move({n:"e_pink6",y:-.1,ry:-30}),W.move({n:"e_pink8",x:-1.1,y:.1,ry:-30}),i.x=.7,i.z=-3,i.ry=30):8==t&&(s=-.2),this.ri||(W.move({n:"btn13",x:-.6,y:-1.2,z:s,rx:-90,ry:10}),W.move({n:"s_lbl_btn13",x:-.6,y:-1.189,z:s,rx:-90,ry:10}))}W.move(i),W.move(e),W.move(h)}Is(t){this.fs=[[0,13],[0,3],[0,3,9],[0,3,6,9],[0,2,3,4,5,6,7,8,9,10,11,12],[1]][t-1];for(let t=0;t<14;t++)W.move({n:"btn"+t,b:this.fs.includes(t)?"ddd":"aaa"});if(2==t)W.plane({n:"s_note2",g:"dlg",x:.3,y:-.3,z:.0251,w:this.Ps,h:1.414*this.Ps,rz:20,t:i.F.W.$});else if(3==t)W.plane({n:"s_note3",x:this.vs/2-.03,y:-.2,z:-.1,w:this.Ps,h:1.414*this.Ps,ry:-90,t:i.F.W.$}),this.ai("𝍫");else if(4==t)this.ws=.9,W.plane({n:"s_note4",x:-.1,y:-this.zs/2,w:this.Ps,h:1.414*this.Ps,rx:-90,ry:5,t:i.F.W.$,b:"000",mix:.7}),this.ai("𝍬");else if(5==t)this.ws=.8,W.plane({n:"s_note5c",x:this.vs/2-.03,y:-.2,z:-.1,w:this.Ps,h:1.414*this.Ps,ry:-90,t:i.F.W.$}),W.plane({n:"s_note5b",x:this.vs/2-.031,y:-.1,z:.18,w:this.Ps,h:1.414*this.Ps,ry:-90,t:i.F.W.$}),W.plane({n:"s_note5a",x:-this.vs/2+.031,w:this.Ps,h:1.414*this.Ps,ry:90,t:i.F.W.$}),W.move({n:"btn13",z:100}),W.move({n:"s_lbl_btn13",z:100}),W.move({n:"e_blue",x:-1,y:-.4,ry:-45,t:i.F.st("•  •","7ae")}),this.ai("𝍸");else if(6==t){this.ws=1;const[t,s]=i.L.H(600,100,"note6");s.font="italic 32px "+i.di,s.fillStyle="#555",s.textBaseline="top";const e=i.F.U.s_note6;for(let t=0;t<e.length;t++)s.fillText(e[t],300,20+40*t);W.plane({n:"note6",y:-.1,z:.99,w:.6,h:.1,ry:180,t}),W.clearColor("eee"),W.delete("plane"),W.delete("dsl"),W.delete("dsr"),this.ai("𝍸𝍩")}t>1&&(W.move({n:"loops",z:.0251}),W.delete("s_note1"),W.delete("title")),t>2&&W.delete("s_note2"),t>3&&W.delete("s_note3"),t>4&&(W.delete("s_note4"),W.delete("e_pink1"),W.delete("e_pink2"),W.delete("e_pink3"),W.delete("e_pink4"),W.delete("e_pink7"))}ti(t,s,e){let h=0;this.cs.push({duration:6,qs:n=>{if(this.ni(n))return 1;if(8*n-h<1||n>=1)return;h=8*n;let o=(1-n)*t,r=(1-n)*s,l=(1-n)*(e+.6)-.6;o+=Math.round(h)%2?.07:-.07,i.Audio.play(i.Audio.ot,0,.1+.1*h),i.Audio.text("*thump*","f00",.5,{x:o,y:-.5,z:l}),W.move({n:"e_red",x:o,y:r,z:l})}})}ui(){const t=[];for(let s=0;s<this.cs.length;s++){const e=this.cs[s];e.start??=this.Kt;const h=(this.Kt-e.start)/(e.duration*i.D);e.qs(h)&&t.push(e)}this.cs=this.cs.filter((s=>!t.includes(s)))}Ys(){if(this.Vs){const t=W.next[this.Vs.n];this.oi(t)}}Ds(t){W.move({n:"dis",t:i.F.tt(t),mix:.25})}si(t,s){if(this.ci==t)return;this.ci=t,this.us=!0;const e=this.loop,h={};if(t==i.Zt.es){W.next.dialog&&W.move({n:"dialog",z:100});const t={x:W.next.camera.x,y:W.next.camera.y,z:W.next.camera.z},s=this.gs-this.ps;h.duration=Math.min(5,1.2*Math.abs(s)),i.Audio.play(i.Audio.nt,h.duration),h.qs=e=>{if(this.Ds(this.ps+Math.round(e*s)),e>1)return this.Rs(this.gs),W.camera(t),i.Audio.play(i.Audio.et),i.Audio.text("*ding*","ff0",3,W.next.display),this.ps=this.gs,this.bs.push(this.ps),this.hi((()=>{this._s=i.Ws.IDLE,this.si(i.Zt.ts),setTimeout((()=>this.Xs(this.ps)),1)})),1;W.camera({x:t.x+(2*Math.random()-1)/300,y:t.y+(2*Math.random()-1)/300,z:t.z+(2*Math.random()-1)/300})}}else if(t==i.Zt.hs)this.us=!1,i.L.It=!0,W.camera({rx:0,ry:0,a:500,onAnimDone:()=>{const t=W.next.e_red.z;this.cs.push({duration:3,qs:s=>{if(i.L.Pt.fillStyle=`rgba(0,0,0,${Math.min(1,s)})`,i.L.Pt.fillRect(0,0,i.L.Ct.width,i.L.Ct.height),s>1)return W.move({n:"e_red",z:100}),this.li(e+1),setTimeout((()=>this.si(i.Zt.ss,1)),1),1;const h=-.5*s;W.camera({z:h}),W.move({n:"e_red",z:t+4*h})}})}});else if(t==i.Zt.os)this.us=!1,h.duration=3,h.qs=t=>{if(i.L.It=!0,i.L.Pt.fillStyle=`rgba(0,0,0,${Math.min(1,t)})`,i.L.Pt.fillRect(0,0,i.L.Ct.width,i.L.Ct.height),t>1)return this.li(e),setTimeout((()=>this.si(i.Zt.ss,1)),1),1};else if(t==i.Zt.ss)this.us=!1,this.ei(),h.duration=4,h.qs=t=>{i.L.It=!0;const e={z:0,rx:0,ry:0};if(t>1)return W.camera(e),i.L.It=!1,i.L.camera.rx=0,i.L.camera.ry=0,i.L.Yt=null,document.getElementById("p").hidden=!1,W.delete("title"),setTimeout((()=>this.si(i.Zt.ts)),1),1;1==s&&(i.L.Pt.fillStyle=`rgba(0,0,0,${1-t})`,i.L.Pt.fillRect(0,0,i.L.Ct.width,i.L.Ct.height)),e.z=-.5*(1-Math.sin(t*Math.PI/2)),W.camera(e)};else if(t==i.Zt.I){document.getElementById("p").hidden=!0,document.body.classList.add("p"),this.us=!1,i.L.It=!0,W.camera({z:-.5,rx:0,ry:0});const t=document.getElementById("b");t.onclick=()=>{t.remove(),document.body.classList.remove("p"),this.cs.push({duration:1,qs:t=>(t>1&&setTimeout((()=>this.si(i.Zt.ss)),1),t>1)})}}else t==i.Zt.rs&&(document.getElementById("p").hidden=!0,this.us=!1,i.L.It=!0,W.camera({rx:0,ry:0,a:1e3,onAnimDone:()=>{h.duration=5,h.qs=t=>{if(t<.2)return;t-=.2,W.camera({z:-2*t});const s=Math.min(t,1),e=i.L.Ct.width,h=i.L.Ct.height;i.L.Pt.fillStyle=`rgba(238,238,238,${s})`,i.L.Pt.fillRect(0,0,e,h),i.L.Pt.font="96px "+i.S,i.L.Pt.textAlign="center",i.L.Pt.fillStyle=`rgba(110,110,110,${s})`,i.L.Pt.fillText("ESCAPED",e/2,h/2)},this.cs.push(h)}}));h.qs&&this.cs.push(h)}Qs(t,s,e,h){W.next.dialog||([this.fi,this.xi]=i.L.H(2,2,"dialog"),W.plane({n:"dialog",ns:1,t:this.fi})),h=Math.min(h,1);let n=0,o=0;for(let s=0;s<t.length;s++){const i=t[s];n+=i.length,o=Math.max(o,i.length)}this.fi.width=14*o,this.fi.height=30*t.length,this.xi.clearRect(0,0,this.fi.width,this.fi.height),this.xi.font="600 24px "+i.k,this.xi.textAlign="center",this.xi.textBaseline="top",this.xi.fillStyle="#"+e;const r=Math.round(h*n);let l=0,a=t.length,d="";for(let s=0;s<t.length;s++){const i=t[s].substring(0,r-l);if(l+=i.length,a--,d=i[i.length-1],this.xi.fillText(i,this.fi.width/2,30*s),l>=r)break}W.gl.deleteTexture(W.W.dialog),delete W.W.dialog;const u=i.R(s),c=.075*a;W.move({n:"dialog",x:u.x,y:u.y+u.h/2+.1-c,z:u.z,w:this.fi.width/400,h:this.fi.height/400,t:this.fi}),(this.yi||0)<r&&(this.yi=r," "!=d&&i.Audio.play(i.Audio.rt))}update(t){if(this.Kt+=t,this.ui(),this._i||(this.Wi()&&Math.random()<.02*t?(this._i=!0,W.light({i:.6,a:100,onAnimDone:()=>this._i=!1})):W.next.light.i!=this.ws&&W.light({i:this.ws})),this.note){const t=i.F.U[this.note],s=["s_note4","s_note5a","s_note5b","s_note5c"].includes(this.note)&&"#13d";i.L.Vt(t,s),i.P.Ot(i.P.lt.ut,!0)&&(this.note=null)}else this.us&&this._s==i.Ws.IDLE&&this.Gs()}ai(t){this.Us.clearRect(0,0,this.Bs.width,this.Bs.height),this.Us.fillText(t,0,0),W.gl.deleteTexture(W.W.loops),delete W.W.loops,W.move({n:"loops",t:this.Bs})}};