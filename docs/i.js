pxtex=(t,s,i,e,h=10,n=10,o=10,r=t.getContext`2d`,W,l,a=Math.random)=>{for(t.width=n,t.height=o,W=n;W--;)for(l=o;l--;)r.fillStyle=`hsl(${s+(a()-.5)*h},${i+(a()-.5)*h}%,${e+(a()-.5)*h}%)`,r.fillRect(W,l,1,1)},W={i:{},reset:s=>{W.canvas=s,W.objs=0,W.current={},W.next={},W.o={},W.W=!1,W.gl=s.getContext("webgl2"),W.gl.blendFunc(770,771),W.gl.activeTexture(33984),W.program=W.gl.createProgram(),W.gl.enable(2884),W.gl.shaderSource(t=W.gl.createShader(35633),"#version 300 es\nprecision highp float;in vec4 pos, col, uv;uniform mat4 pv, eye, m, im;uniform vec4 bb;out vec4 v_pos, v_col, v_uv;void main() {gl_Position = pv * (v_pos = bb.z > 0.? m[3] + eye * (pos * bb): m * pos);v_col = col;v_uv = uv;}"),W.gl.compileShader(t),W.gl.attachShader(W.program,t),W.gl.shaderSource(t=W.gl.createShader(35632),"#version 300 es\nprecision highp float;in vec4 v_pos, v_col, v_uv;uniform vec3 light;uniform vec4 o;uniform sampler2D sampler;out vec4 c;void main() {float ambient = o[2];vec3 light_dir = normalize(light - v_pos.xyz);vec3 normal = normalize(cross(dFdx(v_pos.xyz), dFdy(v_pos.xyz)));float lambert = max(0., dot(light_dir, normal)) * 0.7;float specular = 0.;if(o[0] > 0.) {vec3 R = reflect(-light_dir, normal);vec3 V = normalize(-v_pos.xyz);float specAngle = max(dot(R, V), 0.);specular = pow(specAngle, o[0]) * 0.3;}c = mix(texture(sampler, v_uv.xy), v_col, o[3]);float f = o[1] > 0. ? ambient + lambert + specular : 1.;c = vec4(c.rgb * f, c.a);}"),W.gl.compileShader(t),W.gl.attachShader(W.program,t),W.gl.linkProgram(W.program),W.gl.useProgram(W.program),W.gl.clearColor(1,1,1,1),W.clearColor=t=>W.gl.clearColor(...W.l(t)),W.clearColor("fff"),W.gl.enable(2929),W.u({y:1}),W.camera({fov:30}),setTimeout(W.draw,16)},m:(t,s,i,e,h=[],n,o,r,l,a,c,u,d)=>{if(t.n||="o"+W.objs++,t.size&&(t.w=t.h=t.d=t.size),t.t&&t.t.width&&!W.o[t.t.id]&&(i=W.gl.createTexture(),W.gl.pixelStorei(37441,!0),W.gl.bindTexture(3553,i),W.gl.pixelStorei(37440,1),W.gl.texImage2D(3553,0,6408,6408,5121,t.t),W.gl.generateMipmap(3553),W.o[t.t.id]=i),t.fov){const s=1/Math.tan(t.fov*Math.PI/180),i=.1,e=80,h=e-i;W.projection=new DOMMatrix([s/(W.canvas.width/W.canvas.height),0,0,0,0,s,0,0,0,0,-(e+i)/h,-1,0,0,-2*e*i/h,0])}t={type:s,...W.current[t.n]=W.next[t.n]||{w:1,h:1,d:1,x:0,y:0,z:0,rx:0,ry:0,rz:0,b:"888",mix:0},...t,f:0},W.i[t.type]?.vertices&&!W.i?.[t.type].verticesBuffer&&(W.gl.bindBuffer(34962,W.i[t.type].verticesBuffer=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array(W.i[t.type].vertices),35044),W.i[t.type].p||W.smooth(t),W.i[t.type].p&&(W.gl.bindBuffer(34962,W.i[t.type].normalsBuffer=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array(W.i[t.type].p.flat()),35044))),W.i[t.type]?.uv&&!W.i[t.type].uvBuffer&&(W.gl.bindBuffer(34962,W.i[t.type].uvBuffer=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array(W.i[t.type].uv),35044)),W.i[t.type]?.indices&&!W.i[t.type].indicesBuffer&&(W.gl.bindBuffer(34963,W.i[t.type].indicesBuffer=W.gl.createBuffer()),W.gl.bufferData(34963,new Uint16Array(W.i[t.type].indices),35044)),t.t?t.t&&!t.mix&&(t.mix=0):t.mix=1,W.next[t.n]=t},draw:(t,s,i,e,h=[])=>{if(s=t-W.lastFrame,W.lastFrame=t,requestAnimationFrame(W.draw),W.W)W.onDraw(t);else{for(e in W.next.camera.g&&W._(W.next[W.next.camera.g],s,1),i=W.animation("camera"),W.next?.camera?.g&&i.preMultiplySelf(W.next[W.next.camera.g].v),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.program,"eye"),!1,i.toFloat32Array()),i.invertSelf(),i.preMultiplySelf(W.projection),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.program,"pv"),!1,i.toFloat32Array()),W.gl.clear(16640),W.next){const t=W.next[e];t.t||1!=W.l(t.b)[3]?h.push(t):W._(t,s)}for(e of(h.sort(((t,s)=>W.M(s)-W.M(t))),W.gl.enable(3042),h))["plane","billboard"].includes(e.type)&&W.gl.depthMask(0),W._(e,s),W.gl.depthMask(1);W.gl.disable(3042),W.gl.uniform3f(W.gl.getUniformLocation(W.program,"light"),W.T("light","x"),W.T("light","y"),W.T("light","z")),W.onDraw(t)}},_:(t,s,i=["camera","light","group"].includes(t.type),e)=>{t.t&&(W.gl.bindTexture(3553,W.o[t.t.id]),W.gl.uniform1i(W.gl.getUniformLocation(W.program,"sampler"),0)),t.f>=t.a?(t.onAnimDone?.(),delete t.a,delete t.onAnimDone):t.f<t.a&&(t.f+=s),t.f>t.a&&(t.f=t.a),W.next[t.n].v=W.animation(t.n),W.next[t.g]&&W.next[t.n].v.preMultiplySelf(W.next[t.g].v),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.program,"m"),!1,W.next[t.n].v.toFloat32Array()),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.program,"im"),!1,DOMMatrix.fromMatrix(W.next[t.n].v).invertSelf().toFloat32Array()),i||(W.gl.bindBuffer(34962,W.i[t.type].verticesBuffer),W.gl.vertexAttribPointer(e=W.gl.getAttribLocation(W.program,"pos"),3,5126,!1,0,0),W.gl.enableVertexAttribArray(e),W.i[t.type].uvBuffer&&(W.gl.bindBuffer(34962,W.i[t.type].uvBuffer),W.gl.vertexAttribPointer(e=W.gl.getAttribLocation(W.program,"uv"),2,5126,!1,0,0),W.gl.enableVertexAttribArray(e)),W.gl.uniform4f(W.gl.getUniformLocation(W.program,"o"),t.s,t.ns?0:1,W.ambientLight||.2,t.mix),W.gl.uniform4f(W.gl.getUniformLocation(W.program,"bb"),t.w,t.h,"billboard"==t.type,0),W.i[t.type].indicesBuffer&&W.gl.bindBuffer(34963,W.i[t.type].indicesBuffer),W.gl.vertexAttrib4fv(W.gl.getAttribLocation(W.program,"col"),W.l(t.b)),W.i[t.type].indicesBuffer?W.gl.drawElements(4,W.i[t.type].indices.length,5123,0):W.gl.drawArrays(4,0,W.i[t.type].vertices.length/3))},T:(t,s)=>{const i=W.next[t];if(!i?.a)return i[s];const e=W.current[t];return e[s]+(i[s]-e[s])*(i.f/i.a)},animation:(t,s=new DOMMatrix)=>W.next[t]?s.translateSelf(W.T(t,"x"),W.T(t,"y"),W.T(t,"z")).rotateSelf(W.T(t,"rx"),W.T(t,"ry"),W.T(t,"rz")).scaleSelf(W.T(t,"w"),W.T(t,"h"),W.T(t,"d")):s,M:(t,s=W.next.camera)=>t?.v&&s?.v?(s.v.m41-t.v.m41)**2+(s.v.m42-t.v.m42)**2+(s.v.m43-t.v.m43)**2:0,A:t=>W.ambientLight=t,l:t=>[...t.match(t.length<5?/./g:/../g).map((s=>("0x"+s)/(t.length<5?15:255))),1],add:(t,s)=>{W.i[t]=s,s.p&&(W.i[t].customNormals=1),W[t]=s=>W.m(s,t)},group:t=>W.m(t,"group"),move:(t,s)=>setTimeout((()=>{W.m(t)}),s||1),delete:(t,s)=>setTimeout((()=>{delete W.next[t]}),s||1),camera:(t,s)=>setTimeout((()=>{W.m(t,t.n="camera")}),s||1),u:(t,s)=>s?setTimeout((()=>{W.m(t,t.n="light")}),s):W.m(t,t.n="light")},W.smooth=(t,s={},i=[],e,h,n,o,r,l,a,c,u,d,f)=>{for(W.i[t.type].p=[],n=0;n<W.i[t.type].vertices.length;n+=3)i.push(W.i[t.type].vertices.slice(n,n+3));for((e=W.i[t.type].indices)?h=1:(e=i,h=0),n=0;n<2*e.length;n+=3){o=n%e.length,r=i[c=h?W.i[t.type].indices[o]:o],l=i[u=h?W.i[t.type].indices[o+1]:o+1],a=i[d=h?W.i[t.type].indices[o+2]:o+2],AB=[l[0]-r[0],l[1]-r[1],l[2]-r[2]],BC=[a[0]-l[0],a[1]-l[1],a[2]-l[2]],f=n>o?[0,0,0]:[AB[1]*BC[2]-AB[2]*BC[1],AB[2]*BC[0]-AB[0]*BC[2],AB[0]*BC[1]-AB[1]*BC[0]];const m=r[0]+"_"+r[1]+"_"+r[2],g=l[0]+"_"+l[1]+"_"+l[2],b=a[0]+"_"+a[1]+"_"+a[2];s[m]||=[0,0,0],s[g]||=[0,0,0],s[b]||=[0,0,0],W.i[t.type].p[c]=s[m]=s[m].map(((t,s)=>t+f[s])),W.i[t.type].p[u]=s[g]=s[g].map(((t,s)=>t+f[s])),W.i[t.type].p[d]=s[b]=s[b].map(((t,s)=>t+f[s]))}},W.add("plane",{vertices:[.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[1,1,0,1,0,0,1,1,0,0,1,0]}),W.add("billboard",W.i.plane),W.add("cube",{vertices:[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5],uv:[1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0]}),W.cube=t=>W.m(t,"cube");let s=new AudioContext;"use strict";const i={O:'"Courier New", monospace',N:"Arial, sans-serif",S:'"Times New Roman", serif',I:30,D:60,k:"Triskaidekaphobia",F(t){if(!t.g)return t;const s=W.next[t.g];return{x:s.x+t.x,y:s.y+t.y,z:s.z+t.z}},init(){i.L.C((()=>{i.R.init(),i.B.init()}))},P(){const t=localStorage.getItem("2024_sd_elevator.save");return t?JSON.parse(t):null},K(t){localStorage.setItem("2024_sd_elevator.save",JSON.stringify({level:t}))}};window.addEventListener("load",(()=>i.init())),i.L={G:{s_note1:"I'm leaving this note for whoever gets lost\nhere as well. You are now stuck in a cursed\nelevator. But if I'm not in here (and neither\nmy dead body), I must've made it out!\n\nDon't worry, I'm going to leave you some\ntips as I figure this situation out!",s_note2:"Everything went black and now I am on 1 again. My note is also gone.\nThere is a fellow on floor 3, seems harmless.",s_note3:"Back again, last note gone again. Floor 7 is new.",s_note4:"Guess this is from that Note-Writter. Found a note book with torn pages. Feeling like keeping up the tradition.",s_note5a:"NO MORE REPEATS",s_note5b:"SICK OF PAIN",s_note5c:"WHERE IS THE BUTTON",s_note6:"Lost note book. Is 1 the way out? Got hope.",blue1:"Please go. Leave me alone.",blue2:"Go. Don't it find me.",blue3:"not...alone",blue4:"It won't find me here, right? Why come back? Oh, it smells rotten... Please go. Leave me alone.",pink1:"Join us? Safe together. Step out the elevator. Let us huddle together.",pink2:"Offer still stands. Always welcome."},o:{},U(){for(let t=0;t<14;t++){const s="s_lbl_btn"+t,e=0==t?"><":String(t).padStart(2,"0"),[h,n]=i.B.V(100,70,s);n.font="600 32px "+i.N,n.textBaseline="middle",n.fillText(e,50,37),this.o[s]=h}},H(){const t=Math.round(70.7),s=i.B.V(50,t,"paper")[0];pxtex(s,0,0,95,3,50,t),this.o.$=s},J(){const t=i.B.V(200,300,"wall")[0];pxtex(t,0,0,20,3,200,300),this.o.j=t;const s=i.B.V(100,100,"ceil")[0];pxtex(s,0,0,100,3,100,100),this.o.ceil=s;const e=i.B.V(100,100,"floor")[0];pxtex(e,0,0,10,1,100,100),this.o.floor=e;const h=i.B.V(40,300,"fs")[0];pxtex(h,0,0,20,3,40,300),this.o.Y=h;const n=i.B.V(200,75,"ft")[0];pxtex(n,0,0,20,3,200,75),this.o.q=n},X(){const t=Math.round(120),[s,e]=i.B.V(600,t,"title");e.fillStyle="#f00",e.font="600 64px "+i.S,e.fillText(i.k,300,t/2),this.o.title=s},Z(t,s){const e="audio:"+t+s;if(this.o[e])return this.o[e];const h=Math.round(100),[n,o]=i.B.V(200,h,e);return o.fillStyle="#"+s,o.font="36px "+i.N,o.textBaseline="middle",o.fillText(String(t),100,h/2+6),this.o[e]=n,n},tt(t){const s="dis:"+t;if(this.o[s])return this.o[s];const e=200,h=Math.round(100),[n,o]=i.B.V(e,h,s);return o.fillStyle="#f00",o.fillRect(0,0,e,h),o.fillStyle="#fff",o.font="600 64px "+i.O,o.textBaseline="middle",o.fillText(String(t),100,h/2+6),this.o[s]=n,n},st(t,s){const e="eyes:"+t+s;if(this.o[e])return this.o[e];const[h,n]=i.B.V(200,50,e);return n.fillStyle="#"+s,n.font="600 42px "+i.O,n.textBaseline="middle",n.fillText(String(t),100,25),this.o[e]=h,h},C(t){this.X(),this.U(),this.J(),this.H(),t()}},i.Audio={it:[.5,0,626,,.01,.01,,2.2,,,,,,,,.1,.01,.79,.02],et:[2,0,783.99,.07,,1.6,1,2,,,,,,,,,,.3,.15],ERROR:[.5,0,71,,.02,.05,3,.2,,68,,,,,,,.01,.96,.02,,389],play(t){((t=1,i=.05,e=220,h=0,n=0,o=.1,r=0,W=1,l=0,a=0,c=0,u=0,d=0,f=0,m=0,g=0,b=0,y=1,x=0,p=0,_=0)=>{let v=Math,w=2*v.PI,z=44100,M=l*=500*w/z/z,T=e*=(1-i+2*i*v.random(i=[]))*w/z,A=0,E=0,O=0,N=1,S=0,I=0,D=0,k=_<0?-1:1,F=w*k*_*2/z,C=v.cos(F),L=v.sin,R=L(F)/4,B=1+R,P=-2*C/B,K=(1-R)/B,G=(1+k*C)/2/B,U=-(k+C)/B,V=G,H=0,$=0,J=0,j=0;for(a*=500*w/z**3,m*=w/z,c*=w/z,u*=z,d=z*d|0,t*=.3,k=(h=z*h+9)+(x*=z)+(n*=z)+(o*=z)+(b*=z)|0;O<k;i[O++]=D*t)++I%(100*g|0)||(D=r?1<r?2<r?3<r?L(A**3):v.max(v.min(v.tan(A),1),-1):1-(2*A/w%2+2)%2:1-4*v.abs(v.round(A/w)-A/w):L(A),D=(d?1-p+p*L(w*O/d):1)*(D<0?-1:1)*v.abs(D)**W*(O<h?O/h:O<h+x?1-(O-h)/x*(1-y):O<h+x+n?y:O<k-b?(k-O-b)/o*y:0),D=b?D/2+(b>O?0:(O<k-b?1:(k-O)/b)*i[O-b|0]/2/t):D,_&&(D=j=V*H+U*(H=$)+G*($=D)-K*J-P*(J=j))),F=(e+=l+=a)*v.cos(m*E++),A+=F+F*f*L(O**5),N&&++N>u&&(e+=c,T+=c,N=0),!d||++S%d||(e=T,l=M,N=N||1);(t=s.createBuffer(1,k,z)).getChannelData(0).set(i),(e=s.createBufferSource()).buffer=t,e.connect(s.destination),e.start()})(...t)},text(t,s,e,h){t=`*${t}*`;const n=i.L.Z(t,s),o=.01*e;W.plane({n:n.id,g:h.g,x:h.x,y:h.y+.05,z:h.z+.1,w:.5,h:.25,t:n,ns:1}),W.move({n:n.id,y:h.y+.05+o,a:1e3*e,onAnimDone:()=>W.delete(n.id)})}},i.R={ht:{nt:1,ot:2,rt:3,Wt:10,lt:11,ct:12,ut:13},dt:{},ft:{},gt:{},bt:{},yt(){this.xt={[this.ht.nt]:{keyboard:["Escape"]},[this.ht.lt]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"]},[this.ht.Wt]:{keyboard:["ArrowLeft","KeyA","KeyQ"]},[this.ht.ut]:{keyboard:["ArrowDown","KeyS"]},[this.ht.ct]:{keyboard:["ArrowRight","KeyD"]},[this.ht.ot]:{keyboard:["KeyE","Enter"]}}},_t(){let t=0,s=0;return this.vt(this.ht.Wt)?t=-1:this.vt(this.ht.ct)&&(t=1),this.vt(this.ht.lt)?s=-1:this.vt(this.ht.ut)&&(s=1),{x:t,y:s}},wt(t){return this.xt[t]},init(){this.yt(),this.zt()},vt(t,s){const i=this.wt(t);for(const t of i.keyboard)if(this.Mt(t,s))return!0;return!1},Mt(t,s){const i=this.bt[t];return!(!i||!i.time)&&(s&&(i.time=0,i.Tt=!0),!0)},At(t,s){const i=this.ft[t]||[];i.push(s),this.ft[t]=i},Et(t,s){const i=this.gt[t]||[];i.push(s),this.gt[t]=i},zt(){document.body.onkeydown=t=>{const s=this.bt[t.code];s&&s.Tt||(this.bt[t.code]={time:Date.now()},this.ft[t.code]&&this.ft[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.bt[t.code]={time:0},this.gt[t.code]&&this.gt[t.code].forEach((t=>t()))}}},i.B={camera:{rx:0,ry:0},Ot:!1,Nt:null,St:null,It:null,Dt:null,kt:new DOMPoint(0,0,-1),Ft:0,Ct(){let t=[];const s=this.Lt(),i={min:[],max:[]};for(const e in W.next){if(!e.startsWith("s_"))continue;const h=W.next[e];let n=0;if("plane"!=h.type&&"billboard"!=h.type&&(n=h.d),i.min[0]=h.x-h.w/2,i.min[1]=h.y-h.h/2,i.min[2]=h.z-n/2,h.g){const t=W.next[h.g];i.min[0]+=t.x,i.min[1]+=t.y,i.min[2]+=t.z}i.max[0]=i.min[0]+h.w,i.max[1]=i.min[1]+h.h,i.max[2]=i.min[2]+n;const o=this.Rt(s,i);o&&t.push([h,o])}const e=this.Bt(s.origin,t);return!e?.n.startsWith("s__")&&e},Pt(t){const s=Math.round(Math.min(735.28,window.innerHeight-40)),e=(this.St.width-520)/2,h=(this.St.height-s)/2;this.Dt.drawImage(i.L.o.$,e,h,520,s),this.Dt.fillStyle="#000",this.Dt.font="24px "+i.N,this.Dt.textAlign="left",this.Dt.textBaseline="top";const n=t.split("\n");for(let t=0;t<n.length;t++)this.Dt.fillText(n[t],e+20,h+20+29*t)},Kt(){this.Dt.fillStyle="#00000070",this.Dt.fillRect(0,0,this.St.width,this.St.height),this.Dt.fillStyle="#fff",this.Dt.font="96px "+i.S,this.Dt.textAlign="center",this.Dt.fillText("PAUSED",this.St.width/2,this.St.height/2)},Bt(t,s){if(1==s.length)return s[0][0];let i=null,e=1/0;for(let h=0;h<s.length;h++){const n=s[h][1],o=[n[0]-t[0],n[1]-t[1],n[2]-t[2]],r=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]);r<e&&(i=s[h][0],e=r)}return i},V(t,s,i){const e=document.createElement("canvas");e.width=t,e.height=s,i&&(e.id=i);const h=e.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,h.textAlign="center",[e,h]},Lt(){const t=W.next.camera,s=(new DOMMatrix).rotateSelf(t.rx,t.ry,t.rz),i={origin:[t.x,t.y,t.z],dir:this.kt.matrixTransform(s)};return i.dir=[i.dir.x,i.dir.y,i.dir.z],i},init(){this.Nt=document.getElementById("c"),this.St=document.getElementById("ui"),this.Dt=this.St.getContext("2d",{alpha:!0}),this.Dt.imageSmoothingEnabled=!1,this.resize(),W.onDraw=this.update.bind(this),W.reset(this.Nt),W.clearColor("000"),W.A(.2),this.zt(),this.level=new i.Gt},Rt(t,s){let i=!0,e=[],h=[],n=[],o=[];for(let h=0;h<3;h++)t.origin[h]<s.min[h]?(e[h]=1,n[h]=s.min[h],i=!1):t.origin[h]>s.max[h]?(e[h]=0,n[h]=s.max[h],i=!1):e[h]=2;if(i)return t.origin;for(let s=0;s<3;s++)2!=e[s]&&0!=t.dir[s]?h[s]=(n[s]-t.origin[s])/t.dir[s]:h[s]=-1;let r=0;for(let t=1;t<3;t++)h[r]<h[t]&&(r=t);if(h[r]<0)return null;for(let i=0;i<3;i++)if(r!=i){if(o[i]=t.origin[i]+h[r]*t.dir[i],o[i]<s.min[i]||o[i]>s.max[i])return null}else o[i]=n[i];return o},pause(){this.W=!0,document.body.classList.add("p"),W.W=!0},zt(){let t=null,s=null;window.addEventListener("resize",(t=>this.resize()));const e=i.R.wt(i.R.ht.nt),h=()=>{this.Ut(),t=null,s=null};e.keyboard.forEach((t=>i.R.Et(t,h))),this.Nt.addEventListener("mousedown",(t=>{0===t.button&&this.level&&this.level.Vt()})),this.Nt.addEventListener("mouseenter",(i=>{this.level&&!this.Ot&&(t=i.clientX,s=i.clientY)})),this.Nt.addEventListener("mousemove",(i=>{if(this.level&&!this.W&&!this.Ot){if(null===t)return t=i.clientX,void(s=i.clientY);this.camera.rx-=.4*(i.clientY-s),this.camera.ry-=.4*(i.clientX-t),this.camera.rx=Math.min(80,Math.max(-60,this.camera.rx)),this.camera.ry=this.camera.ry%360,W.camera(this.camera),t=i.clientX,s=i.clientY}})),i.R.Et("KeyR",(()=>{this.Ot||(this.camera.rx=0,this.camera.ry=0,W.camera(this.camera))}))},resize(){const t=4/3;let s=window.innerWidth,i=window.innerHeight;s>i?(i-=40,s=Math.round(Math.min(s,i*t))):s<i&&(s-=40,i=Math.round(Math.min(i,s*t))),this.Nt.width=s,this.Nt.height=i,this.St.width=s,this.St.height=i,W.next?.camera&&(W.camera({fov:W.next.camera.fov}),W.gl.viewport(0,0,s,i))},Ut(){this.W?this.unpause():this.pause()},unpause(){this.W=!1,document.body.classList.remove("p"),W.W=!1},update(t=0){if(t&&this.Ht){const s=(t-this.Ht)/(1e3/i.D);if(this.Dt.clearRect(0,0,this.St.width,this.St.height),this.Dt.imageSmoothingEnabled=!1,this.Dt.fillStyle="#fff",this.Dt.font="11px monospace",this.Dt.textAlign="left",this.Dt.fillText(~~(i.D/s)+" FPS",10,20),this.W)return void this.Kt();if(this.Ft+=s,this.level.update(s),!this.Ot){const t=.3;i.R.vt(i.R.ht.lt)?this.camera.rx+=t:i.R.vt(i.R.ht.ut)&&(this.camera.rx-=t),i.R.vt(i.R.ht.Wt)?this.camera.ry+=t:i.R.vt(i.R.ht.ct)&&(this.camera.ry-=t),this.camera.rx=Math.min(80,Math.max(-60,this.camera.rx)),this.camera.ry=this.camera.ry%360,W.camera(this.camera)}}this.Ht=t}},i.$t={Jt:0,k:1,jt:2,Yt:3,qt:4},i.Qt={OPEN:1,OPENING:2,CLOSED:3,CLOSING:4,IDLE:5,Xt:6},i.Gt=class{constructor(){this.Zt=0,this.ts=!0,this.ss=[],this.Ft=0,this.es=[],this.hs=0,this.os=i.Qt.OPEN,this.rs=i.Qt.IDLE,this.Ws=1,this.ls=1,this.cs=[],this.loop=2,this.note=null,this.us=i.$t.Jt,this.ds=2.5,this.fs=3,this.gs=2,W.u({y:this.fs/2-.2}),W.plane({n:"title",z:-2,w:1,h:.2,b:"f00",t:i.L.o.title}),W.group({n:"ev"}),this.bs(),this.ys(),this.xs(),this.ps(),this._s(),this.vs(),this.ws(this.Ws),this.zs(this.loop),this.Ms(this.Ws)}xs(){const t="display";W.group({n:t,g:"ev",y:this.fs/2-.25-.15,z:-this.gs/2+.06}),W.plane({g:t,n:"dis",w:.5,h:.25,b:"f00"})}ys(){const t=this.ds/2,s=.05;this.Ts=t/2+.0025,this.As=this.Ts+this.ds/2-this.ds/3.5,W.group({n:"dlg",g:"ev",x:-this.As,z:-this.gs/2}),W.cube({g:"dlg",w:t,h:this.fs,d:s,b:"aaa",s:20}),W.plane({g:"dlg",b:"0008",y:-this.fs/2-.001,z:-.27,h:100,rx:-90,ry:20,ns:1}),W.group({n:"drg",g:"ev",x:this.As,z:-this.gs/2}),W.cube({g:"drg",w:t,h:this.fs,d:s,b:"aaa",s:20}),W.plane({g:"drg",b:"0008",y:-this.fs/2-.001,z:-.27,h:100,rx:-90,ry:-20,ns:1});const e=t/4;W.plane({n:"s_note1",g:"drg",x:(e-t)/2+.1,y:-.1,z:.025+.001,w:e,h:1.414*e,rz:-10,t:i.L.o.$})}ps(){const t="pad";W.group({n:t,g:"ev",x:this.ds/2-.3,y:-.175,z:-this.gs/2+.051}),W.plane({g:t,w:.3,h:.7,b:"bbb",s:20});const s=.02,e=.1,h=.07,n=(e+s)/2;for(let o=0;o<14;o++){const r="btn"+o,l=o%2*(s+e)-n,a=~~(o/2)*(s+h)-.27;W.cube({g:t,n:r,x:l,y:a,w:e,h,d:.02,b:"ddd"}),W.plane({g:t,n:"s_lbl_"+r,x:l,y:a,z:.011,w:e,h,t:i.L.o["s_lbl_"+r]})}}bs(){const t="ev";W.group({n:t,g:"ev"}),W.plane({g:t,y:-this.fs/2,w:this.ds,h:this.gs,rx:-90,b:"333",t:i.L.o.floor,mix:.5}),W.plane({g:t,y:this.fs/2,w:this.ds,h:this.gs,rx:90,b:"bbb",t:i.L.o.ceil,mix:.5}),W.plane({g:t,x:-this.ds/2,ry:90,w:this.gs,h:this.fs,b:"999",t:i.L.o.j,s:30,mix:.5}),W.plane({g:t,x:this.ds/2,ry:-90,w:this.gs,h:this.fs,b:"999",t:i.L.o.j,s:30,mix:.5}),W.plane({g:t,z:this.gs/2,ry:180,w:this.ds,h:this.fs,b:"999",t:i.L.o.j,s:30,mix:.5}),W.cube({g:t,x:-this.ds/2+.02,y:-this.fs/5,w:.04,h:.15,d:this.gs,b:"aaa",s:30}),W.cube({g:t,x:this.ds/2-.02,y:-this.fs/5,w:.04,h:.15,d:this.gs,b:"aaa",s:30}),W.cube({g:t,y:-this.fs/5,z:this.gs/2-.02,w:this.ds,h:.15,d:.04,b:"aaa",s:30}),W.cube({g:t,x:-(this.ds-this.ds/4.5)/2,z:-this.gs/2,w:this.ds/4.5,h:this.fs,d:.1,b:"999",t:i.L.o.Y,s:30,mix:.5}),W.cube({g:t,n:"s__fr",x:(this.ds-this.ds/4.5)/2,z:-this.gs/2,w:this.ds/4.5,h:this.fs,d:.1,b:"999",t:i.L.o.Y,s:30,mix:.5}),W.cube({g:t,y:(this.fs-this.fs/4)/2,z:-this.gs/2,w:this.ds,h:this.fs/4,d:.1,b:"999",t:i.L.o.q,s:30,mix:.5})}_s(){W.plane({y:-this.fs/2-.002,z:-this.gs/2-10,w:30,h:20,rx:90,rz:180,b:"111"}),W.plane({n:"e_red",y:.8,z:100,w:.5,h:.125,t:i.L.st("•   •","f00")}),W.plane({n:"e_blue",y:-.1,z:100,w:.5,h:.125,t:i.L.st("•   •","77f")}),W.group({n:"e_pink_all",z:100}),W.plane({g:"e_pink_all",n:"e_pink1",y:.8,w:.5,h:.125,t:i.L.st("•   •","f2c")})}vs(){const t="fff",s=.005;W.group({n:"hl"}),W.cube({n:"hl_t",g:"hl",size:s,b:t,ns:1}),W.cube({n:"hl_r",g:"hl",size:s,b:t,ns:1}),W.cube({n:"hl_b",g:"hl",size:s,b:t,ns:1}),W.cube({n:"hl_l",g:"hl",size:s,b:t,ns:1})}Es(){if(this.Ft-this.Zt>.05*i.D){this.Zt=this.Ft;const t=i.B.Ct();if(t&&t.n!=this.Ns?.Os){let s=t.n;s.startsWith("s_lbl_btn")&&(s=s.substring(6));W.next[s]&&(this.Ns={Os:t.n,n:s})}else!t&&this.Ns&&(this.Ns=null)}if(this.Ss(this.Ns),this.Ns){const t=i.B.St,s=i.B.Dt;s.fillStyle="#fff",s.font="20px "+i.O,s.textAlign="center",s.fillText("[E]/LEFT-CLICK TO SELECT",t.width/2,t.height-42),i.R.vt(i.R.ht.ot,!0)&&this.Is()}}Vt(){this.note?this.note=null:this.Is()}Ds(t){const s=this.loop,e=this.es.includes(13);let h=i.$t.Jt;if(1==s)13==t&&(h=i.$t.qt);else if(2==s)e||this.es.push(13),3==t?this.ss.push({duration:2,ks:t=>{const s=W.next.e_blue;return this.Fs(i.L.G.blue1,s,"77f",t),3!=this.Ws}}):13==t&&(h=i.$t.qt);else{if(3==s){if(!e&&this.Cs([3,7])&&this.es.push(13),3==t);else if(7==t);else if(13==t){const{y:t,z:s}=W.next.e_red,e=.3-t,h=-1.5-s;this.ss.push({duration:2,ks:n=>(W.move({n:"e_red",y:t+e*n,z:s+h*n}),n>=1&&(this.Ls(i.$t.qt),!0))})}return}4==s?(!e&&this.Cs([3,4,7])&&this.es.push(13),3==t||7==t||13==t&&(h=i.$t.qt)):5==s&&(3==t||7==t||(13==t?h=i.$t.qt:this.cs.includes(7)&&Math.random()))}this.Ls(h)}Rs(){return[i.Qt.CLOSING,i.Qt.OPENING].includes(this.os)}Bs(t){this.os==i.Qt.CLOSED||this.Rs()?t?.():(this.os=i.Qt.CLOSING,W.move({n:"dlg",x:-this.Ts,a:2e3}),W.move({n:"drg",x:this.Ts,a:2e3,onAnimDone:()=>{this.os=i.Qt.CLOSED,t?.()}}))}Ps(t){this.os==i.Qt.OPEN||this.Rs()?t?.():(this.os=i.Qt.OPENING,W.move({n:"dlg",x:-this.As,a:2e3}),W.move({n:"drg",x:this.As,a:2e3,onAnimDone:()=>{this.os=i.Qt.OPEN,t?.()}}))}Ks(t){if(t)if(t.n.startsWith("s_note"))this.note=t.n;else if(t.n.startsWith("btn")&&this.rs==i.Qt.IDLE){if(!this.Gs(t.n))return void i.Audio.play(i.Audio.ERROR);i.Audio.play(i.Audio.it),i.Audio.text("beep","ff0",1,t);const s=Number(t.n.substring(3));if(0==s)return void this.Bs();if(this.Ws==s)return void(this.os==i.Qt.OPEN?this.Bs():this.Ps());this.ls=s,this.rs=i.Qt.Xt,this.Bs((()=>this.Ls(i.$t.Yt)))}}Cs(t){for(let s=0;s<t.length;s++)if(!this.cs.includes(t[s]))return!1;return!0}Ss(t){if(!t||!this.Gs(t.n))return void W.move({n:"hl",z:100});const s=W.next[t.n],e=i.F(s),h=.005;W.move({n:"hl",x:e.x,y:e.y,z:e.z+.01,rz:s.rz}),W.move({n:"hl_t",y:s.h/2,w:s.w,h}),W.move({n:"hl_r",x:s.w/2,h:s.h,w:h}),W.move({n:"hl_b",y:-s.h/2,w:s.w,h}),W.move({n:"hl_l",x:-s.w/2,h:s.h,w:h})}Gs(t){return this.es.includes(Number(t.replace("btn","")))}Us(t){W.camera({x:0,y:0,z:0}),this.loop=t,this.cs=[],this.Ws=1,this.ls=1,this.ws(1),this.zs(t),this.Ns=null}Ms(t){const s=this.loop,i={n:"e_red",y:.8,z:100},e={n:"e_blue",z:100};1==s?13==t&&(i.z=-3):2==s?3==t?e.z=-4:13==t&&(i.z=-3):3==s?13==t&&(i.z=-3):4==s?7==t&&(i.z=-3):5==s&&7==t&&(i.z=-3),W.move(i),W.move(e)}zs(t){this.es=[[0,13],[0,3],[0,3,7],[0,3,4,7],[0,2,3,4,5,6,7,8,9,10,11,12],[1]][t-1],2==t&&W.delete("s_note1")}Vs(){for(let t=this.ss.length-1;t>=0;t--){const s=this.ss[t];s.start??=this.Ft;const e=(this.Ft-s.start)/(s.duration*i.D);s.ks(e)&&this.ss.splice(t)}}Is(){if(this.Ns){const t=W.next[this.Ns.n];this.Ks(t)}}ws(t){W.move({n:"dis",t:i.L.tt(t),mix:.25})}Ls(t){if(this.us==t)return;this.us=t,this.ts=!0;const s={};if(t==i.$t.Yt){const t={x:W.next.camera.x,y:W.next.camera.y,z:W.next.camera.z},e=this.ls-this.Ws;s.duration=Math.min(5,1.2*Math.abs(e)),s.ks=s=>(this.ws(this.Ws+Math.round(s*e)),s>1?(this.Ms(this.ls),W.camera(t),i.Audio.play(i.Audio.et),i.Audio.text("ding","ff0",3,W.next.display),this.Ws=this.ls,this.cs.push(this.Ws),this.Ps((()=>{this.rs=i.Qt.IDLE,setTimeout((()=>this.Ds(this.Ws)),1)})),!0):(W.camera({x:t.x+(2*Math.random()-1)/300,y:t.y+(2*Math.random()-1)/300,z:t.z+(2*Math.random()-1)/300}),!1))}else if(t==i.$t.qt){this.ts=!1;const t=this.loop,e=W.next.e_red.z;s.duration=3,s.ks=s=>{i.B.Ot=!0;const h={z:0,rx:0,ry:0};return s>=1?(i.B.Ot=!1,W.move({n:"e_red",z:100}),this.Us(t+1),setTimeout((()=>this.Ls(i.$t.jt)),1),!0):(h.z=-.5*s,W.move({n:"e_red",z:e+h.z}),W.camera(h),!1)}}else t==i.$t.jt?(this.ts=!1,this.Bs(),s.duration=3,s.ks=t=>{i.B.Ot=!0;const s={z:0,rx:0,ry:0};return t>1?(W.camera(s),i.B.Ot=!1,document.getElementById("p").hidden=!1,W.delete("title"),setTimeout((()=>this.Ls(i.$t.Jt)),1),!0):(s.z=-.5*(1-Math.sin(t*Math.PI/2)),W.camera(s),!1)}):t==i.$t.k&&(document.getElementById("p").hidden=!0,this.ts=!1,s.duration=3,s.ks=t=>(i.B.Ot=!0,W.camera({z:-.5,rx:0,ry:0}),t>=1&&setTimeout((()=>this.Ls(i.$t.jt)),1),t>=1));s.ks&&this.ss.push(s)}Fs(t,s,e,h){W.next.dialog||([this.Hs,this.$s]=i.B.V(100,60,"dialog"),W.billboard({n:"dialog",ns:1,t:this.Hs})),h=Math.min(h,1),this.Hs.width=14*t.length,this.$s.clearRect(0,0,this.Hs.width,this.Hs.height),this.$s.font="600 24px "+i.N,this.$s.textAlign="center",this.$s.fillStyle="#"+e,this.$s.fillText(t.substring(0,h*t.length),this.Hs.width/2,this.Hs.height/2),W.gl.deleteTexture(W.o.dialog),delete W.o.dialog,W.move({n:"dialog",x:s.x,y:s.y+s.h/2+.1,z:s.z,w:1,h:this.Hs.height/this.Hs.width,t:this.Hs})}update(t){if(this.Ft+=t,this.Vs(),this.note){const t=i.L.G[this.note];i.B.Pt(t),i.R.vt(i.R.ht.ot,!0)&&(this.note=null)}else this.ts&&this.rs==i.Qt.IDLE&&this.Es()}};